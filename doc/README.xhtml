<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>BAli-Phy User's Guide v2.1.0</title><link rel="stylesheet" href="docbook.css" type="text/css" /><meta name="generator" content="DocBook XSL Stylesheets V1.72.0" /></head><body><div class="article" lang="en" xml:lang="en"><div class="titlepage"><div><div><h1 class="title"><a id="id310394"></a><span class="application">BAli-Phy</span> User's Guide v2.1.0</h1></div><div><div class="author"><h3 class="author"><span class="firstname">Benjamin</span> <span class="surname">Redelings</span></h3></div></div></div><hr /></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="sect1"><a href="#id310417">1. Pre-requisites</a></span></dt><dd><dl><dt><span class="sect2"><a href="#id310422">1.1. Hardware Requirements</a></span></dt><dt><span class="sect2"><a href="#id258548">1.2. Operating System requirements</a></span></dt><dt><span class="sect2"><a href="#id259378">1.3. Software Requirements</a></span></dt></dl></dd><dt><span class="sect1"><a href="#id258032">2. Compiling <span class="application">BAli-Phy</span></a></span></dt><dd><dl><dt><span class="sect2"><a href="#id258053">2.1. Quick Start</a></span></dt><dt><span class="sect2"><a href="#id305372">2.2. Installing to a location besides	<code class="filename">/usr/local/</code></a></span></dt><dt><span class="sect2"><a href="#id305443">2.3. Specifying where to find libraries and header files (e.g. GSL)</a></span></dt><dt><span class="sect2"><a href="#id300540">2.4. Selecting a non-default C++ compiler</a></span></dt><dt><span class="sect2"><a href="#id300595">2.5. Optimizing for a specific architecture</a></span></dt><dt><span class="sect2"><a href="#id300668">2.6. Statically linked executables</a></span></dt><dt><span class="sect2"><a href="#svnsource">2.7. Generating Autoconf/Automake files</a></span></dt><dt><span class="sect2"><a href="#id312675">2.8. Examples</a></span></dt></dl></dd><dt><span class="sect1"><a href="#id312717">3. Installation</a></span></dt><dd><dl><dt><span class="sect2"><a href="#id312723">3.1. Installing when compiling from source</a></span></dt><dt><span class="sect2"><a href="#id312749">3.2. Installing precompiled binaries</a></span></dt><dt><span class="sect2"><a href="#id312793">3.3. Setting the PATH</a></span></dt></dl></dd><dt><span class="sect1"><a href="#id312971">4. Running the program</a></span></dt><dd><dl><dt><span class="sect2"><a href="#id312976">4.1. The simple way</a></span></dt><dt><span class="sect2"><a href="#spec_data_dir">4.2. Locating the Data/ directory</a></span></dt><dt><span class="sect2"><a href="#id313261">4.3. Option files (Scripts)</a></span></dt><dt><span class="sect2"><a href="#id313401">4.4. Running long simulations</a></span></dt></dl></dd><dt><span class="sect1"><a href="#id313521">5. Command-line options</a></span></dt><dd><dl><dt><span class="sect2"><a href="#id313527">5.1. Usage</a></span></dt><dt><span class="sect2"><a href="#id313581">5.2. General options</a></span></dt><dt><span class="sect2"><a href="#id313727">5.3. MCMC options</a></span></dt><dt><span class="sect2"><a href="#id313815">5.4. Parameter options</a></span></dt><dt><span class="sect2"><a href="#id313935">5.5. Model options</a></span></dt></dl></dd><dt><span class="sect1"><a href="#id314006">6. Examples</a></span></dt><dt><span class="sect1"><a href="#id314164">7. Input</a></span></dt><dd><dl><dt><span class="sect2"><a href="#id314169">7.1. Sequence formats</a></span></dt><dt><span class="sect2"><a href="#id314192">7.2. Is my data set too large?</a></span></dt></dl></dd><dt><span class="sect1"><a href="#id314278">8. Models</a></span></dt><dd><dl><dt><span class="sect2"><a href="#subst_basic">8.1. Substitution models (Basic)</a></span></dt><dt><span class="sect2"><a href="#id315489">8.2. Indel models</a></span></dt><dt><span class="sect2"><a href="#id315499">8.3. Alignment constraints</a></span></dt></dl></dd><dt><span class="sect1"><a href="#subst_adv">9. Substitution Models (Advanced)</a></span></dt><dd><dl><dt><span class="sect2"><a href="#id315653">9.1. Specifying a substitution model</a></span></dt><dt><span class="sect2"><a href="#id315678">9.2. CTMC Frequency models</a></span></dt><dt><span class="sect2"><a href="#id315929">9.3. Frequency Models</a></span></dt><dt><span class="sect2"><a href="#id316383">9.4. CTMC Mixture Models</a></span></dt><dt><span class="sect2"><a href="#id317180">9.5. Examples</a></span></dt></dl></dd><dt><span class="sect1"><a href="#id317217">10. Output</a></span></dt><dd><dl><dt><span class="sect2"><a href="#id317222">10.1. Output directory</a></span></dt><dt><span class="sect2"><a href="#id317272">10.2. Output files</a></span></dt></dl></dd><dt><span class="sect1"><a href="#mixing_and_convergence">11. Convergence and Mixing: Is it done yet?</a></span></dt><dd><dl><dt><span class="sect2"><a href="#id317438">11.1. Convergence</a></span></dt><dt><span class="sect2"><a href="#id317500">11.2. Mixing</a></span></dt></dl></dd><dt><span class="sect1"><a href="#analysis">12. Analyzing the output</a></span></dt><dd><dl><dt><span class="sect2"><a href="#id317567">12.1. How to run the full analysis</a></span></dt><dt><span class="sect2"><a href="#id317710">12.2. Results/</a></span></dt><dt><span class="sect2"><a href="#id317930">12.3. Mixing/</a></span></dt></dl></dd><dt><span class="sect1"><a href="#id318018">13. Tuning the Markov Chain</a></span></dt><dd><dl><dt><span class="sect2"><a href="#id318039">13.1. Parameters</a></span></dt></dl></dd><dt><span class="sect1"><a href="#id318308">14. Auxiliary tools</a></span></dt><dd><dl><dt><span class="sect2"><a href="#id318324">14.1. alignment-find</a></span></dt><dt><span class="sect2"><a href="#id318340">14.2. alignment-draw</a></span></dt><dt><span class="sect2"><a href="#id318362">14.3. alignment-thin</a></span></dt><dt><span class="sect2"><a href="#id318383">14.4. alignment-chop-internal</a></span></dt><dt><span class="sect2"><a href="#id318402">14.5. alignment-info</a></span></dt><dt><span class="sect2"><a href="#id318428">14.6. alignment-indices</a></span></dt><dt><span class="sect2"><a href="#id318447">14.7. alignment-cat</a></span></dt><dt><span class="sect2"><a href="#id318468">14.8. trees-consensus</a></span></dt><dt><span class="sect2"><a href="#id318491">14.9. trees-bootstrap</a></span></dt><dt><span class="sect2"><a href="#id318533">14.10. trees-to-SRQ</a></span></dt></dl></dd><dt><span class="sect1"><a href="#id318589">15. Frequently Asked Questions (FAQ)</a></span></dt><dd><dl><dt><span class="sect2"><a href="#id318595">15.1. Running <span><strong class="command">bali-phy</strong></span>.</a></span></dt><dt><span class="sect2"><a href="#id318637">15.2. Stopping <span><strong class="command">bali-phy</strong></span>.</a></span></dt><dt><span class="sect2"><a href="#id318735">15.3. Interpreting the results.</a></span></dt></dl></dd></dl></div><div class="sect1" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id310417"></a>1. Pre-requisites</h2></div></div></div><div class="sect2" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id310422"></a>1.1. Hardware Requirements</h3></div></div></div><p><span class="application">BAli-Phy</span> should be able to
	run on any hardware with a modern operating system, including
	Linux or UNIX, Windows, and Mac OS X.</p><p>We recommend at least 512Mb of RAM and a 1.5GHz
	processor.  We typically run
	<span class="application">BAli-Phy</span> on Pentium 4 processors
	with 1Gb of RAM and a 3 GHz processor.</p></div><div class="sect2" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id258548"></a>1.2. Operating System requirements</h3></div></div></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Command line ahead!</h3><p><span class="application">BAli-Phy</span> is not a
	    graphical application.  While there are Mac and Windows
	    version available, these assume that you understand some
	    UNIX commands, or at least are not intimidated by them.
	    BAli-Phy is (hopefully) usable, but it is not "user-friendly"!
	    </p></div><div class="sect3" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="id258569"></a>1.2.1. Linux and UNIX</h4></div></div></div><p>A Linux or UNIX system should be able to install and
	  run <span class="application">BAli-Phy</span> without any modification.</p></div><div class="sect3" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="id258584"></a>1.2.2. Windows</h4></div></div></div><p>On Windows you must first install <a href="http://www.cygwin.com" target="_top">cygwin</a>.  Cygwin is a
	  Linux environment for Windows.  You can use the cygwin
	  installer to install other software packages that you
	  need (See <a href="#software_req">Section 1.3, “Software Requirements”</a>). You can access the
	  Cygwin command line (not the normal windows command line)
	  through the Start menu.</p></div><div class="sect3" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="id258607"></a>1.2.3. Mac OS X</h4></div></div></div><p>A Mac OS X system is based on UNIX, and should be able to
	  compile and run <span class="application">BAli-Phy</span>.  The version
	  of OS X must be 10.1 or higher.  If you want to use the
	  development tools from Apple to compile
	  <span class="application">BAli-Phy</span>, the system must be 10.4 or
	  higher, and you must upgrade to XCode 2.2 or higher (see Software
	  Requirements).
	  </p><p>You can use <a href="http://fink.sourceforge.net" target="_top">Fink</a> to install
	  other useful applications, such as gnuplot.
	  </p></div></div><div class="sect2" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id259378"></a>1.3. Software Requirements</h3></div></div></div><div class="sect3" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="id259386"></a>1.3.1. Compilation Requirements</h4></div></div></div><p>The following software packages are required for compiling BAli-Phy:

	</p><div class="itemizedlist"><ul type="disc"><li><p> A modern C++ compiler (<a href="http://gcc.gnu.org" target="_top">GCC</a> version 3.4, 4.0, and
	  4.1 are known to work)</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Mac OS X issues:</h3><p>If you want to use the development tools shipped by Apple
	    (e.g. GCC) then you need OS X version 10.4 (Tiger) or higher, and
	    you need to install XCode 2.2 or higher.  (You can use a GCC compiler
	    built from the non-apple FSF sources, but installing XCode is
	    much simpler.) 
	    </p></div></li><li><p>GNU make version 3.80 or higher  (<a href="http://www.gnu.org/software/make" target="_top">GNU make</a>).
	  </p></li><li><p> The GNU Scientific Library (<a href="http://sources.redhat.com/gsl/" target="_top">GSL</a>) version 1.8 or higher.</p></li></ul></div><p>
	</p></div><div class="sect3" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="id258186"></a>1.3.2. Requirements for analyzing <span class="application">BAli-Phy</span> output</h4></div></div></div><p>After you run <span><strong class="command">bali-phy</strong></span> you will
	  need to run an analysis of the resulting files (See <a href="#analysis" title="12.&#xA0;Analyzing the output">Section 12, “Analyzing the output”</a>).  This analysis depends on the
	  following software packages: 

	  </p><div class="itemizedlist"><ul type="disc"><li><p>GNU make version 3.80 or higher  (<a href="http://www.gnu.org/software/make" target="_top">GNU make</a>).
	    </p></li><li><p>PERL</p></li></ul></div><p>

	  </p></div><div class="sect3" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="id257969"></a>1.3.3. Recommendations for analysis and documentation</h4></div></div></div><p>In addition, the following software packages are
	  strongly recommended.  These packages allow you to view
	  plots and diagnostics for
	  <span class="application">BAli-Phy</span>, or to view the
	  documentation correctly.

	  </p><div class="itemizedlist"><ul type="disc"><li><p><span class="application">Tracer</span> - to
	    analyze MCMC diagnostics 
	    (<a href="http://evolve.zoo.ox.ac.uk/software/tracer/" target="_top">Tracer</a>) 
	    </p></li><li><p>The plotting program
	    <span class="application">gnuplot</span> (<a href="http://www.gnuplot.info/" target="_top">gnuplot</a>)</p></li><li><p>Mozilla or Mozilla/Firefox - to view the math in
	    the XHTML documentation. (<a href="http://www.mozilla.org/products/firefox/" target="_top">Firefox</a>)</p></li></ul></div><p>
	  </p></div></div></div><div class="sect1" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id258032"></a>2. Compiling <span class="application">BAli-Phy</span></h2></div></div></div><p>If you are compiling source code that you checked out using
      subversion (and you probably aren't) then follow the directions
      in <a href="#svnsource" title="2.7.&#xA0;Generating Autoconf/Automake files">Section 2.7, “Generating Autoconf/Automake files”</a> before you start compiling.
      </p><div class="sect2" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id258053"></a>2.1. Quick Start</h3></div></div></div><p>In order to compile the program on UNIX, first
      extract the source code archive, using a graphical archive
      manager, or the command-line tool <span><strong class="command">tar</strong></span>:
      
      </p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>tar -zxf bali-phy-1.9.9.tgz</code></strong></pre><p>
      Then create a <span class="emphasis"><em>separate</em></span> build directory, enter it, and run the
      configure command:

      </p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>mkdir build</code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>cd build</code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>../bali-phy-1.9.9/configure</code></strong></pre><p>
 
      If this command succeeds, then you can simply type

      </p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>make</code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>make install</code></strong></pre><p>

      to build and install <span><strong class="command">bali-phy</strong></span> and its
      associated tools.  (This requires GNU <span><strong class="command">make</strong></span>.)
      To customize the compilation and installation process, read the
      following sections on supplying arguments to the
      <span><strong class="command">configure</strong></span> script.
      </p></div><div class="sect2" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id305372"></a>2.2. Installing to a location besides	<code class="filename">/usr/local/</code></h3></div></div></div><p>The configure script chooses to install
	<span><strong class="command">bali-phy</strong></span> in the directory
	<code class="filename">/usr/local/</code> by default. We can install
	binaries to another directory <em class="replaceable"><code>dir</code></em>
	by passing
	<strong class="userinput"><code>--prefix=<em class="replaceable"><code>dir</code></em></code></strong>.
	For example, in order to install
	<span class="application">BAli-Phy</span> under
	<code class="filename">~/local</code>, you can do:

</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>../bali-phy-1.9.9/configure --prefix=$HOME/local</code></strong></pre><p>
        This is recommended if you do not have permission to install
	to <code class="filename">/usr/local/</code>.
	</p></div><div class="sect2" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id305443"></a>2.3. Specifying where to find libraries and header files (e.g. GSL)</h3></div></div></div><p>You can instruct the compiler to look for include files
	in directory <em class="replaceable"><code>dir</code></em> by passing
	<strong class="userinput"><code>--with-extra-includes=<em class="replaceable"><code>dir</code></em></code></strong> to the <span><strong class="command">configure</strong></span> script.
	</p><p>You can instruct the compiler to look for libraries
	files in directory
	<code class="filename"><em class="replaceable"><code>dir</code></em></code> by
	passing
	<strong class="userinput"><code>--with-extra-libs=<em class="replaceable"><code>dir</code></em></code></strong> to the <span><strong class="command">configure</strong></span> script.  
	</p><p>For example, if your system has GSL installed in <code class="filename">/usr/local/</code>, then you might need to add "<strong class="userinput"><code>--with-extra-includes=/usr/local/include --with-extra-libs=/usr/local/lib</code></strong>" to the configure script arguments so that the compiler can find the GSL include files and libraries.</p></div><div class="sect2" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id300540"></a>2.4. Selecting a non-default C++ compiler</h3></div></div></div><p>The default C++ compiler is <span><strong class="command">g++</strong></span>.  On
	some systems, <span><strong class="command">g++</strong></span> invokes GCC version 3.3,
	and the correct compiler is called something else, such as
	<span><strong class="command">g++-4.0</strong></span>.  To use
	<span><strong class="command">g++-4.0</strong></span> as the C++ compiler when compiling
	<span class="application">BAli-Phy</span>, you would set the CXX
	environment variable as follows:
	    </p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>../bali-phy-1.9.9/configure CXX=g++-4.0</code></strong></pre><p>
	</p></div><div class="sect2" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id300595"></a>2.5. Optimizing for a specific architecture</h3></div></div></div><p>You can specify optimizing for a specific brand of CPU,
	by specifying the <strong class="userinput"><code>CHIP</code></strong> variable to
	<span><strong class="command">configure</strong></span>, as follows:
	    </p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>../bali-phy-1.9.9/configure CHIP=<em class="replaceable"><code>cpu</code></em></code></strong></pre><p>
	You can set CHIP to any of <strong class="userinput"><code>pentium3</code></strong>,
	<strong class="userinput"><code>pentium4</code></strong>,
	<strong class="userinput"><code>nocona</code></strong>, <strong class="userinput"><code>G3</code></strong>,
	<strong class="userinput"><code>G4</code></strong>, or <strong class="userinput"><code>G5</code></strong>.
	</p></div><div class="sect2" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id300668"></a>2.6. Statically linked executables</h3></div></div></div><p>Call <span><strong class="command">configure</strong></span> with the flag
	<strong class="userinput"><code>--enable-static</code></strong> to build static
	executables.  Static executables will be able to run on other
	computers with the with the same type of CPU but slightly
	different versions of the operating system. 
	</p></div><div class="sect2" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="svnsource"></a>2.7. Generating Autoconf/Automake files</h3></div></div></div><p>This step is <span class="emphasis"><em>only</em></span> necessary if you
	are using the subversion (SVN) source.  It is
	<span class="emphasis"><em>not</em></span> necessary if you are compiling from a
	distributed tar.gz archive of the source, because these
	archives already include the files that this step will
	generate, such as the <code class="filename">configure</code> script
	and some Makefiles.
	</p><p>To generate these files, you need automake 1.8 or higher
	and autoconf 2.59 or higher.  Run these commands inside the
	<code class="filename">trunk/</code> directory that you checked out.</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>autoheader</code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>aclocal</code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>automake -a</code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>autoconf</code></strong>
</pre><p>
        If your system has multiple version of automake, then you may
	have to type <strong class="userinput"><code>automake-1.8 -a</code></strong> and
	<strong class="userinput"><code>aclocal-1.8</code></strong> instead in order to specify which
	version to use.
	</p></div><div class="sect2" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id312675"></a>2.8. Examples</h3></div></div></div><p>
        All these options to <span><strong class="command">configure</strong></span> can be
	combined, as follows:
</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>../bali-phy-1.9.9/configure --prefix=$HOME/local --enable-static CXX=g++-4.1 CHIP=pentium4</code></strong></pre><p>
        This example uses <span><strong class="command">g++-4.1</strong></span> to build a
	pentium4-optimized version of <span><strong class="command">bali-phy</strong></span> with
	static linkage.
	</p></div></div><div class="sect1" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id312717"></a>3. Installation</h2></div></div></div><div class="sect2" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id312723"></a>3.1. Installing when compiling from source</h3></div></div></div><p>
      After compiling <span class="application">BAli-Phy</span>, you can
      simply type <span><strong class="command">make install</strong></span>.  This will copy the
      compiled binaries to the directory chosen when you ran
      <span><strong class="command">configure</strong></span>. 
      </p></div><div class="sect2" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id312749"></a>3.2. Installing precompiled binaries</h3></div></div></div><p>To install pre-compiled binaries, simply extract the
      compressed archive in the directory of your choice.  If you have
      root access you might extract in
      <code class="filename">/usr/local</code>; if not, you might make a
      directory <code class="filename">~/local</code> in your home directory
      and extract there.
      </p><p>You can extract the compressed archive on the command line
      using the <span><strong class="command">tar</strong></span> command:
</p><pre class="screen"><code class="prompt">%</code> tar -zxf bali-phy-<em class="replaceable"><code>version</code></em>.tgz</pre><p>
      </p></div><div class="sect2" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id312793"></a>3.3. Setting the PATH</h3></div></div></div><p>
    If you installed <span class="application">BAli-Phy</span> to the directory
    <code class="filename">/usr/local/</code>, then you can run
    bali-phy by typing <strong class="userinput"><code>/usr/local/bin/bali-phy</code></strong>.
    However, it would be much nicer to simply type
    <strong class="userinput"><code>bali-phy</code></strong> and let the computer find the
    executable for you.  This can be achieved by putting the directory
    that contains the <code class="filename">bali-phy</code> executables into
    your "path".  (The directory that contains the executables will be
    <code class="filename">/usr/local/bin</code> if you extracted the bali-phy
    archive to the directory <code class="filename">/usr/local</code>, but will
    be somewhere else if you extracted the bali-phy archive somewhere else.)
    </p><p>
    The "path" is a colon-separated list of directories that is
    searched to find program names that you type.  It is stored in a
    variable called PATH.  You can examine it the current value of
    this variable by 
</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>echo $PATH</code></strong></pre><p>
    We will assume that you extracted the bali-phy archive in
    <code class="filename">/usr/local</code> and so you want to add
    <code class="filename">/usr/local/bin</code> to your PATH.  The commands
    for doing depend on what "shell" you are using.  Type
    <strong class="userinput"><code>echo $SHELL</code></strong> to find out.
    </p><p>If your shell is <span><strong class="command">sh</strong></span> or
    <span><strong class="command">bash</strong></span> then the command looks like this: 
</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>PATH=/usr/local/bin:$PATH</code></strong></pre><p>
    If your shell is <span><strong class="command">csh</strong></span> or
    <span><strong class="command">tcsh</strong></span>, then the command looks like this:
</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>setenv PATH /usr/local/bin:$PATH</code></strong></pre><p>
    Unfortunately, the effects of this will affect only the window you
    are typing in, and will vanish when you reboot.  You can put these
    command into the files <code class="filename">.profile</code> (for the
    Bourne shell <span><strong class="command">sh</strong></span>), 
    <code class="filename">.bash_profile</code> (for BASH), or
    <code class="filename">.login</code> (for tcsh).  However, the details are
    beyond the scope of this document.
    </p></div></div><div class="sect1" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id312971"></a>4. Running the program</h2></div></div></div><div class="sect2" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id312976"></a>4.1. The simple way</h3></div></div></div><p>The simplest way to run <span class="application">BAli-Phy</span> is
    to invoke the <span><strong class="command">bali-phy</strong></span> executable directly:

</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>bali-phy <em class="replaceable"><code>sequence-file</code></em> --data-dir <em class="replaceable"><code>prefix</code></em>/share/bali-phy/Data/</code></strong>
</pre><p>

    Here <em class="replaceable"><code>sequence-file</code></em> is a FASTA or PHYLIP
    file containing the sequences you wish to analyze.  It should end
    in <strong class="userinput"><code>.fasta</code></strong> or <strong class="userinput"><code>.phy</code></strong> to
    indicate which format it is using.  Here
    <em class="replaceable"><code>prefix</code></em> stands for the directory
    where you extracted the bali-phy archive.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>If your FASTA file has blank lines, then
      <span><strong class="command">bali-phy</strong></span> will quit reading the file when it
      sees them.  You must remove blank lines from your FASTA files,
      or you will see errors complaining that too few sequences have
      been provided.</p></div></div><div class="sect2" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="spec_data_dir"></a>4.2. Locating the Data/ directory</h3></div></div></div><p>
	<span class="application">BAli-Phy</span> stores important
	information in a "Data" directory, and needs to know where to
	find this information.  This information includes
	the genetic code and the WAG rate matrix.  If you installed
	<span class="application">BAli-Phy</span> in a directory called
	<em class="replaceable"><code>prefix</code></em>, then the Data/ directory
	will be at
	<code class="filename"><em class="replaceable"><code>prefix</code></em>/share/bali-phy/Data/</code>.
      </p><p>
	If you specify the location of the Data/ directory in a
	configuration file, then you do not need to specify it on the
	command line every time. Then, in the future you can just type:

        </p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>bali-phy <em class="replaceable"><code>sequence-file</code></em></code></strong></pre><p>

	If you don't specify where the data directory is, then
	<span class="application">BAli-Phy</span> will look for it at
	<code class="filename">./Data</code>.
      </p><div class="sect3" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="id313130"></a>4.2.1. Put the location in the configuration file</h4></div></div></div><p>
	  Create a new file at <code class="filename">~/.bali-phy</code> and
	  add the following line:
</p><pre class="screen">data-dir = <em class="replaceable"><code>somewhere</code></em>/Data</pre><p>
          Then <span><strong class="command">bali-phy</strong></span> will read this file
	  every time and know where to find the Data directory.  This
	  is the recommended method.
	</p></div><div class="sect3" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="id313163"></a>4.2.2. Making a link/shortcut to the Data directory</h4></div></div></div><p>Instead of specifying the location of the data
	directory, you can make a shortcut to the Data directory:

        </p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>ln -s <em class="replaceable"><code>somewhere</code></em>/Data</code></strong></pre><p>

	The shortcut will then be at <code class="filename">./Data</code>.  Then
	<span><strong class="command">bali-phy</strong></span> will find the data directory  
	at the default location <code class="filename">Data/</code>, but only
	if you run it in the same directory as the shortcut.
	</p></div><div class="sect3" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="id313212"></a>4.2.3. Making your own copy of the Data directory</h4></div></div></div><p>
	  Instead of specifying the location of the data
	  directory, you can make a local copy of the Data directory 
	  that is also called <code class="filename">Data/</code>:

    </p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>cp -r <em class="replaceable"><code>somewhere</code></em>/Data .</code></strong></pre><p>

	Then <span><strong class="command">bali-phy</strong></span> will find the data directory
	at the default location <code class="filename">Data/</code>, but only
	if you run it in the directory as the local copy.
	</p></div></div><div class="sect2" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id313261"></a>4.3. Option files (Scripts)</h3></div></div></div><p>
	Putting the analysis options in an option file instead
	of on the command line can be more convenient if you are going
	to run the same analysis many times, or if you have a large
	number of options.  In addition, the option file may
	contain comments and blank lines, and can be a good way to
	record what options you used in an analysis.
      </p><div class="sect3" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="id313276"></a>4.3.1. Syntax</h4></div></div></div><p>
	An option file is specified the option "<strong class="userinput"><code>--config
	<em class="replaceable"><code>file</code></em></code></strong>" and uses the same
	option names as the command line.  However, the syntax is
	different.  In the option file, each given option is
	on its own line using the syntax "<strong class="userinput"><code>option =
	value</code></strong>" instead of the syntax "<strong class="userinput"><code>--option
	value</code></strong>".  If the option has no value then it is
	given using the syntax  "<strong class="userinput"><code>option =
	option</code></strong>".  If values for an option are given both
	on the the command line and in an option file, then the
	command line value overrides the value in the option file.
      </p></div><div class="sect3" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="id313316"></a>4.3.2. Example</h4></div></div></div><p>
  For example, consider the following
	option file:
</p><pre class="programlisting">#select a data set to analyze
align = examples/EF-Tu/5d.fasta

#select an substitution model
smodel = log-normal+INV

#fix the alignment and do not model indels
traditional = traditional
</pre><p>
        The first option, <strong class="userinput"><code>align</code></strong> is the name of
	the sequence file, which has no name on the command line.
	Lines that begin with # are comments, and blank lines are
	ignored.  The option <strong class="userinput"><code>--traditional</code></strong> uses
	the option name as the value, because it does not take a
	value.  Thus, this configuration file corresponds to the
	command line
</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>bali-phy examples/EF-Tu/5d.fasta --smodel log-normal+INV --traditional</code></strong>
</pre><p>
      </p></div><div class="sect3" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="id313364"></a>4.3.3. The configuration file</h4></div></div></div><p>
	  The file <code class="filename">~/.bali-phy</code> is a special
	  option file called the <span class="emphasis"><em>configuration
	  file.</em></span>  If it exists, it is always loaded.  If
	  options are given on the command line or an option file they
	  always override values given in the configuration file.  You
	  should use your configuration file to set global values that
	  are the same in all your analyses, such as the location of
	  the Data directory.  Thus, you probably would not want to
	  set <strong class="userinput"><code>align</code></strong> in this file.  However,
	  setting <strong class="userinput"><code>smodel</code></strong> would change the
	  default substitution model while allowing a specific
	  analysis to override the default.
	</p></div></div><div class="sect2" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id313401"></a>4.4. Running long simulations</h3></div></div></div><p>In order to run <span><strong class="command">bali-phy</strong></span> for long
      periods of time, some modifications to the above commands may be
      necessary.</p><div class="sect3" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="id313417"></a>4.4.1. CPU time limits</h4></div></div></div><p>If <span><strong class="command">bali-phy</strong></span> is terminating
	prematurely, CPU time limits may be the cause.  In the BASH
	shell you can find the soft and hard time limits (in seconds)
	using the commands <strong class="userinput"><code>ulimit -St</code></strong> and 
	<strong class="userinput"><code>ulimit -Ht</code></strong>
	respectively. <span class="application">BAli-Phy</span> ignores the 
	soft limit, but cannot ignore the hard limit.  If the hard
	limit is not long enough, you must ask your system
	administrator to change it for you.
        </p></div><div class="sect3" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="id313454"></a>4.4.2. Hangup (HUP) Signals</h4></div></div></div><p>Most programs will terminate when you log out,
        or when you close the terminal that started them.  The 
        <span><strong class="command">nohup</strong></span> command is often used to avoid this.
        <span class="application">BAli-Phy</span> ignores the HUP (hangup)
        signal in versions 1.9.9 and newer, making
	<span><strong class="command">nohup</strong></span> unnecessary. 
        </p></div><div class="sect3" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="id313484"></a>4.4.3. Submitting jobs on an SGE cluster</h4></div></div></div><p>
        You can use the wrapper script <span><strong class="command">bali-phy-sge</strong></span>
	to submit a <span><strong class="command">bali-phy</strong></span> job on an SGE
	cluster.  It takes the same arguments as
	<span><strong class="command">bali-phy</strong></span>, and submits a job for you using the
	<span><strong class="command">qsub</strong></span> command.
        </p></div></div></div><div class="sect1" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id313521"></a>5. Command-line options</h2></div></div></div><div class="sect2" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id313527"></a>5.1. Usage</h3></div></div></div><p>The syntax for the program is:</p><div class="cmdsynopsis"><p><code class="command">bali-phy</code>  {<em class="replaceable"><code>sequence-file</code></em>} [OPTIONS]</p></div><p>The sequence file is the only required argument.  It can
      be either a FASTA (*.fasta) file or a PHYLIP (*.phy) file.  The
      file must end in one of these two suffixes or
      <span class="application">BAli-Phy</span> won't know how to read
      it. In addition your FASTA files should not contain any blank
      lines.</p><p>The optional arguments are described below.</p></div><div class="sect2" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id313581"></a>5.2. General options</h3></div></div></div><div class="variablelist"><table border="0"><col align="left" valign="top" /><tbody><tr><td><span class="term"><code class="option">--help</code></span></td><td><p>Show help message.</p></td></tr><tr><td><span class="term"><code class="option">--version</code></span></td><td><p>Show version information.</p></td></tr><tr><td><span class="term"><code class="option">--config <em class="replaceable"><code>file</code></em></code></span></td><td><p>Option file to read.</p></td></tr><tr><td><span class="term"><code class="option">--show-only</code></span></td><td><p>Analyze initial values and exit.</p></td></tr><tr><td><span class="term"><code class="option">--seed <em class="replaceable"><code>seed</code></em></code></span></td><td><p>Use the specified seed to initialize the
	  random number generator.</p></td></tr><tr><td><span class="term"><code class="option">--data-dir <em class="replaceable"><code>directory</code></em></code></span></td><td><p>Specify the data directory.</p></td></tr><tr><td><span class="term"><code class="option">--name <em class="replaceable"><code>string</code></em></code></span></td><td><p>Specify the name for the analysis directory.</p></td></tr><tr><td><span class="term"><code class="option">--align-constraint <em class="replaceable"><code>file</code></em></code></span></td><td><p>Specify a file with alignment constraints</p></td></tr><tr><td><span class="term"><code class="option">--traditional</code></span></td><td><p>Fix the alignment and don't model indels.</p></td></tr><tr><td><span class="term"><code class="option">--letters star</code></span></td><td><p>Use a star tree for the substitution model.</p></td></tr></tbody></table></div></div><div class="sect2" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id313727"></a>5.3. MCMC options</h3></div></div></div><div class="variablelist"><table border="0"><col align="left" valign="top" /><tbody><tr><td><span class="term"><code class="option">--iterations <em class="replaceable"><code>number=100000</code></em></code></span></td><td><p>Specify the number of iterations to run.</p></td></tr><tr><td><span class="term"><code class="option">--subsample <em class="replaceable"><code>factor=1</code></em></code></span></td><td><p>Specify a factor by which to subsample.</p></td></tr><tr><td><span class="term"><code class="option">--T <em class="replaceable"><code>temperature=1</code></em></code></span></td><td><p>Specify a temperature for MCMCMC.</p></td></tr><tr><td><span class="term"><code class="option">--enable <em class="replaceable"><code>move</code></em></code></span></td><td><p>Enable a comma-separated list of transition kernels.</p></td></tr><tr><td><span class="term"><code class="option">--disable <em class="replaceable"><code>move</code></em></code></span></td><td><p>Disable a comma-separated list of transition kernels.</p></td></tr></tbody></table></div></div><div class="sect2" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id313815"></a>5.4. Parameter options</h3></div></div></div><div class="variablelist"><table border="0"><col align="left" valign="top" /><tbody><tr><td><span class="term"><code class="option">--randomize-alignment</code></span></td><td><p>Randomly re-align sequences before use.</p></td></tr><tr><td><span class="term"><code class="option">--internal +</code></span></td><td><p>Set all internal node entries wildcards initially.</p></td></tr><tr><td><span class="term"><code class="option">--tree <em class="replaceable"><code>file</code></em></code></span></td><td><p>Specify file with initial tree.</p></td></tr><tr><td><span class="term"><code class="option">--set <em class="replaceable"><code>parameter=value</code></em></code></span></td><td><p>Specify initial value of <em class="replaceable"><code>parameter</code></em>.</p></td></tr><tr><td><span class="term"><code class="option">--fix <em class="replaceable"><code>parameter[=value]</code></em></code></span></td><td><p>Mark <em class="replaceable"><code>parameter</code></em> fixed, and optionally specify a value.</p></td></tr><tr><td><span class="term"><code class="option">--unfix <em class="replaceable"><code>parameter[=value]</code></em></code></span></td><td><p>Mark <em class="replaceable"><code>parameter</code></em> not fixed, and optionally specify an initial value.</p></td></tr><tr><td><span class="term"><code class="option">--frequencies <em class="replaceable"><code>frequencies</code></em></code></span></td><td><p>Specify initial frequencies: 'uniform','nucleotides', or a comma-separated list of frequencies.</p></td></tr></tbody></table></div></div><div class="sect2" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id313935"></a>5.5. Model options</h3></div></div></div><div class="variablelist"><table border="0"><col align="left" valign="top" /><tbody><tr><td><span class="term"><code class="option">--alphabet <em class="replaceable"><code>name</code></em></code></span></td><td><p>Specify the alphabet: DNA, RNA, Amino-Acids, Amino-Acids+stop, Triplets, Codons, or Codons + stop.</p></td></tr><tr><td><span class="term"><code class="option">--genetic-code <em class="replaceable"><code>file=standard-code.txt</code></em></code></span></td><td><p>Specify alternate genetic code file in the
	  data directory.</p></td></tr><tr><td><span class="term"><code class="option">--smodel <em class="replaceable"><code>name</code></em></code></span></td><td><p>Specify the substitution model.</p></td></tr><tr><td><span class="term"><code class="option">--imodel <em class="replaceable"><code>name</code></em></code></span></td><td><p>Specify the indel model.</p></td></tr></tbody></table></div></div></div><div class="sect1" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id314006"></a>6. Examples</h2></div></div></div><p>Here are some examples which demonstrate how to run
    <span class="application">BAli-Phy</span>.  In order to run these
    examples, you must first do two things.  Firstly, you must specify
    the location of the <code class="filename">Data/</code> directory is specified as in <a href="#spec_data_dir" title="4.2.&#xA0;Locating the Data/ directory">Section 4.2, “Locating the Data/ directory”</a>.</p><p>Secondly, you must find the <code class="filename">examples/</code>
    directory which contains the example files.  Typically, the
    <code class="filename">examples/</code> directory will be found at
    <code class="filename"><em class="replaceable"><code>prefix</code></em>/share/bali-phy/examples/</code> if you installed <span class="application">bali-phy</span> in directory <em class="replaceable"><code>prefix</code></em>.
    </p><div class="example"><a id="id314069"></a><p class="title"><b>Example 1. No frills</b></p><div class="example-contents"><p>Here we analyze the EF-Tu 5-taxon data set provided with
      the software.</p><pre class="screen"> <code class="prompt">%</code> <strong class="userinput"><code>bali-phy <em class="replaceable"><code>somewhere</code></em>/examples/EF-Tu/5d.fasta</code></strong></pre></div></div><br class="example-break" /><div class="example"><a id="id314099"></a><p class="title"><b>Example 2. Multiple-Rate Substitution Model</b></p><div class="example-contents"><p>We now modify the previous example by changing the
      substitution model to allow log-normal-distributed rate variation and
      invariant sites.  The amount of rate variation and the fraction of
      invariant sites are estimated</p><pre class="screen"> <code class="prompt">%</code> <strong class="userinput"><code>bali-phy <em class="replaceable"><code>somewhere</code></em>/examples/EF-Tu/5d.fasta --smodel log-normal+INV --randomize-alignment</code></strong></pre></div></div><br class="example-break" /><div class="example"><a id="id314130"></a><p class="title"><b>Example 3. Fixed alignment</b></p><div class="example-contents"><p>Here we use the 5S rRNA 5-taxon data set provided with
      the software.  The alignment is fixed and the traditional
      likelihood model is used, making indels non-informative.  In
      addition, the transition kernel which samples nucleotide frequencies
      is disabled, fixing the nucleotide frequencies to empirical values
      estimated from the input sequences.
      </p><pre class="screen"> <code class="prompt">%</code> <strong class="userinput"><code>bali-phy <em class="replaceable"><code>somewhere</code></em>/examples/5S-rRNA/5d.fasta --smodel pi=constant --traditional</code></strong></pre></div></div><br class="example-break" /></div><div class="sect1" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id314164"></a>7. Input</h2></div></div></div><div class="sect2" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id314169"></a>7.1. Sequence formats</h3></div></div></div><p><span class="application">BAli-Phy</span> can read in sequences
      and alignments in both FASTA and PHYLIP formats.  However, in
      FASTA format, the file must not contain blank lines between the
      sequences, because <span class="application">BAli-Phy</span> will stop
      reading in sequences when it sees a blank line.
      </p></div><div class="sect2" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id314192"></a>7.2. Is my data set too large?</h3></div></div></div><p>Large data sets run more slowly than small data
      sets. We recommend a conservative starting point with few taxa
      and short sequence lengths.  You can then increase the size of
      your data set until a balance between speed and size is
      reached.</p><p>The number of samples that you need depends on whether you
      are primarily interested in obtaining a point estimate or in
      obtaining detailed measures of confidence and uncertainty.  For
      detailed measures of confidence and uncertainty you should
      obtain a minimum of 10,000 samples after the Markov chain
      converges.  For an estimate, you don't need very many samples
      after convergence.  (But you may need many samples to be sure
      that you've converged!)
      </p><div class="sect3" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="id314211"></a>7.2.1. Too many taxa?</h4></div></div></div><p><span class="application">BAli-Phy</span> is quite CPU
	intensive, and so we recommend using 12 or fewer taxa in order
	to limit the time required to accumulate enough MCMC samples.
	We note that many phylogenetic hypotheses can be reduced to
	hypotheses concerning only four taxa.  We recommend initially
	removing as many taxa as possible from your data set.  You can
	then add taxa back into the data set after you have determined
	how much this will increase the duration of the run.</p></div><div class="sect3" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="id314229"></a>7.2.2. Sequences too long?</h4></div></div></div><p>Aligning sequences takes <mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" overflow="scroll"><mml:mi>O</mml:mi><mml:mo>(</mml:mo><mml:msup><mml:mi>L</mml:mi> <mml:mn>2 </mml:mn></mml:msup><mml:mo>)</mml:mo></mml:math> time and RAM, where 
	<mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" overflow="scroll"><mml:mi>L</mml:mi></mml:math> represents the sequence length.  Thus, doubling the length
	of the input sequences increases RAM requirements and run
	time by a factor of 4.  Therefore sequence lengths beyond
	750 letters may prove impractical due to limited RAM or the
	speed of the calculation.   For protein sequences,
	we recommend coding the sequences in terms of amino acids or
	codons, rather than nucleotides.</p><p>However, you might try to see how long you can make your
	sequences before the attempt becomes impractical.</p></div></div></div><div class="sect1" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id314278"></a>8. Models</h2></div></div></div><div class="sect2" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="subst_basic"></a>8.1. Substitution models (Basic)</h3></div></div></div><p>The basic substitution models in
      <span class="application">BAli-Phy</span> are continuous-time Markov
      chains (CTMC). More advanced models such as the <mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" overflow="scroll"><mml:msub><mml:mi>Γ</mml:mi> <mml:mn>4 </mml:mn></mml:msub><mml:mo>+</mml:mo><mml:mi>INV</mml:mi></mml:math>
      model or the M2 codon model are described in section
      (<a href="#subst_adv" title="9.&#xA0;Substitution Models (Advanced)">Section 9, “Substitution Models (Advanced)”</a>). CTMC models can be characterized
      by transition rates <mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" overflow="scroll"><mml:msub><mml:mi>Q</mml:mi> <mml:mrow><mml:mi>ij</mml:mi></mml:mrow></mml:msub></mml:math> from letter <mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" overflow="scroll"><mml:mi>i</mml:mi></mml:math> to letter <mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" overflow="scroll"><mml:mi>j</mml:mi></mml:math>.
      After a given time <mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" overflow="scroll"><mml:mi>t</mml:mi></mml:math> the probability for transition from state
      <mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" overflow="scroll"><mml:mi>i</mml:mi></mml:math> to state <mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" overflow="scroll"><mml:mi>j</mml:mi></mml:math> is given by </p><div class="equation"><a id="id314390"></a><p class="title"><b>Equation 0. </b></p><div class="equation-contents"><mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" overflow="scroll"><mml:mi>P</mml:mi><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:msub><mml:mo>)</mml:mo> <mml:mrow><mml:mi>ij</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msup><mml:mi>e</mml:mi> <mml:mrow><mml:msub><mml:mi>Q</mml:mi> <mml:mrow><mml:mi>ij</mml:mi></mml:mrow></mml:msub><mml:mo>×</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msup></mml:math></div></div><p><br class="equation-break" />
      using a matrix exponential.  Becase the The CTMC models used in
      <span class="application">BAli-Phy</span> are all reversible, the rate
      matrix for these reversible models can be decomposed into a
      symmetric matrix <mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" overflow="scroll"><mml:mi>S</mml:mi></mml:math> and equilibrium frequencies <mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" overflow="scroll"><mml:mi>π</mml:mi></mml:math> as
      follows:  </p><div class="equation"><a id="id314458"></a><p class="title"><b>Equation 0. </b></p><div class="equation-contents"><mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" overflow="scroll"><mml:msub><mml:mi>Q</mml:mi> <mml:mrow><mml:mi>ij</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>S</mml:mi> <mml:mrow><mml:mi>ij</mml:mi></mml:mrow></mml:msub><mml:mo>×</mml:mo><mml:msub><mml:mi>π</mml:mi> <mml:mi>j</mml:mi></mml:msub></mml:math></div></div><p><br class="equation-break" />
      The matrix <mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" overflow="scroll"><mml:mi>S</mml:mi></mml:math> is called the exchangability matrix, and
      represents how exchangeable letters <mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" overflow="scroll"><mml:mi>i</mml:mi></mml:math> and <mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" overflow="scroll"><mml:mi>j</mml:mi></mml:math> are
      independent of their frequencies.
      </p><div class="sect3" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="id314522"></a>8.1.1. Basic CTMC models</h4></div></div></div><p>The basic CTMC models are EQU, HKY, TN, GTR, HKYx3,
	TNx3, GTRx3,  Empirical, and M0.  Each of these models is a
	way of specifying the exchangeability matrix <mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" overflow="scroll"><mml:msub><mml:mi>S</mml:mi> <mml:mrow><mml:mi>ij</mml:mi></mml:mrow></mml:msub></mml:math>.</p></div><div class="sect3" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="id314548"></a>8.1.2. Default substitution models</h4></div></div></div><p>If the substitution model is not specified, then the
	default model for the alphabet is used.  For DNA or RNA, the
	default model is HKY.  For Triplets, the default is HKYx3. For
        Codons, the default model is M0.  For Amino-Acids, the
	default model is Empirical[WAG]. 
	</p></div><div class="sect3" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="id314560"></a>8.1.3. Extended model descriptions</h4></div></div></div><div class="table"><a id="id314566"></a><p class="title"><b>Table 1. Substitution Models</b></p><div class="table-contents"><table summary="Substitution Models" border="0"><colgroup><col /><col /><col /><col /></colgroup><thead><tr><th>Model</th><th>Alphabet</th><th>Parameters</th><th>Description</th></tr></thead><tbody><tr><td><strong class="userinput"><code>EQU</code></strong></td><td>any</td><td>none</td><td><mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" overflow="scroll"><mml:msub><mml:mi>S</mml:mi> <mml:mrow><mml:mi>ij</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>1 </mml:mn></mml:math> for every <mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" overflow="scroll"><mml:mi>i</mml:mi></mml:math> and <mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" overflow="scroll"><mml:mi>j</mml:mi></mml:math>.</td></tr><tr><td>
		<p><strong class="userinput"><code>HKY</code></strong></p>
		<p>Hasegawa, Kishino, Yano (1985)</p>
	      </td><td>DNA or RNA</td><td><mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" overflow="scroll"><mml:mi>κ</mml:mi></mml:math>: the ts/tv ratio.</td><td>
		<p><mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" overflow="scroll"><mml:msub><mml:mi>S</mml:mi> <mml:mrow><mml:mi>ij</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>1 </mml:mn></mml:math> for transversions.</p>
		<p><mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" overflow="scroll"><mml:msub><mml:mi>S</mml:mi> <mml:mrow><mml:mi>ij</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mi>κ</mml:mi></mml:math> for transitions.</p>
	      </td></tr><tr><td><p><strong class="userinput"><code>TN</code></strong></p><p>Tamura, Nei (1993)</p></td><td>DNA or RNA</td><td>
		<p><mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" overflow="scroll"><mml:msub><mml:mi>κ</mml:mi> <mml:mn>1 </mml:mn></mml:msub></mml:math>: the purine ts/tv ratio.</p>
		<p><mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" overflow="scroll"><mml:msub><mml:mi>κ</mml:mi> <mml:mn>2 </mml:mn></mml:msub></mml:math>: the pyrimidine ts/tv ratio.</p>
	      </td><td>
		<p><mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" overflow="scroll"><mml:msub><mml:mi>S</mml:mi> <mml:mrow><mml:mi>ij</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>1 </mml:mn></mml:math> for transversions.</p>
		<p><mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" overflow="scroll"><mml:msub><mml:mi>S</mml:mi> <mml:mrow><mml:mi>ij</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>κ</mml:mi> <mml:mn>1 </mml:mn></mml:msub></mml:math> for purine transitions.</p>
		<p><mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" overflow="scroll"><mml:msub><mml:mi>S</mml:mi> <mml:mrow><mml:mi>ij</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>κ</mml:mi> <mml:mn>2 </mml:mn></mml:msub></mml:math> for pyrimidine transitions.</p>
	      </td></tr><tr><td><p><strong class="userinput"><code>GTR</code></strong></p><p>General Time-Reversible</p><p>Tavare (1986)</p></td><td>DNA or RNA</td><td>
		<p><mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" overflow="scroll"><mml:msub><mml:mi>S</mml:mi> <mml:mrow><mml:mi>i</mml:mi><mml:mo>≠</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:math></p>
	      </td><td>
		<p><mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" overflow="scroll"><mml:msub><mml:mo lspace="thinmathspace" rspace="thinmathspace">∑</mml:mo> <mml:mrow><mml:mi>i</mml:mi><mml:mo>≠</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mi>S</mml:mi> <mml:mrow><mml:mi>ij</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>1 </mml:mn></mml:math>.</p><p>(5 degrees of freedom).</p>

	      </td></tr><tr><td>
		<p><strong class="userinput"><code>Empirical[WAG]</code></strong></p>
		<p>Whelan and Goldman (2001)</p>
	      </td><td>Amino-Acids</td><td>
		<p>none.</p>
	      </td><td> </td></tr><tr><td>
		<p><strong class="userinput"><code>HKYx3</code></strong></p>
		<p><strong class="userinput"><code>TNx3</code></strong></p>
		<p><strong class="userinput"><code>GTRx3</code></strong></p>
	      </td><td>Triplets</td><td>
		<p><em class="replaceable"><code>nuc-model</code></em> parameters.</p>
	      </td><td>
		<p>If the nuc-model has transition matrix
		<mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" overflow="scroll"><mml:msubsup><mml:mi>S</mml:mi> <mml:mrow><mml:mi>ij</mml:mi></mml:mrow> <mml:mo>′</mml:mo></mml:msubsup></mml:math> on nucleotides, then:</p>

		<p><mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" overflow="scroll"><mml:msub><mml:mi>S</mml:mi> <mml:mrow><mml:mi>α</mml:mi><mml:mi>β</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>0 </mml:mn></mml:math> for changes of more than one nucleotide.</p>
		<p><mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" overflow="scroll"><mml:msub><mml:mi>S</mml:mi> <mml:mrow><mml:mi>α</mml:mi><mml:mi>β</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msubsup><mml:mi>S</mml:mi> <mml:mrow><mml:mi>ij</mml:mi></mml:mrow> <mml:mo>′</mml:mo></mml:msubsup></mml:math> for single nucleotide  changes <mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" overflow="scroll"><mml:mi>i</mml:mi><mml:mo>→</mml:mo><mml:mi>j</mml:mi></mml:math>.</p>
	      </td></tr><tr><td>
		<p><strong class="userinput"><code>M0</code></strong></p>
		<p>Nielsen and Yang (1998)</p>
	      </td><td>Codons</td><td>
		<p><mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" overflow="scroll"><mml:mi>κ</mml:mi></mml:math>: the ts/tv ratio.</p>
		<p><mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" overflow="scroll"><mml:mi>ω</mml:mi></mml:math>: the dn/ds ratio.</p>
	      </td><td>
		<p><mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" overflow="scroll"><mml:msub><mml:mi>S</mml:mi> <mml:mrow><mml:mi>α</mml:mi><mml:mi>β</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>0 </mml:mn></mml:math> for changes of more than one nucleotide.</p>
		<p><mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" overflow="scroll"><mml:msub><mml:mi>S</mml:mi> <mml:mrow><mml:mi>α</mml:mi><mml:mi>β</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>1 </mml:mn></mml:math> for synonymous transversions.</p>
		<p><mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" overflow="scroll"><mml:msub><mml:mi>S</mml:mi> <mml:mrow><mml:mi>α</mml:mi><mml:mi>β</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mi>ω</mml:mi></mml:math> for non-synonymous transversions.</p>

		<p><mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" overflow="scroll"><mml:msub><mml:mi>S</mml:mi> <mml:mrow><mml:mi>α</mml:mi><mml:mi>β</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mi>κ</mml:mi></mml:math> for synonymous transitions.</p>
		<p><mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" overflow="scroll"><mml:msub><mml:mi>S</mml:mi> <mml:mrow><mml:mi>α</mml:mi><mml:mi>β</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mi>ω</mml:mi><mml:mi>κ</mml:mi></mml:math> for non-synonymous transitions.</p>
	      </td></tr><tr><td>
		<p><strong class="userinput"><code>M0[<em class="replaceable"><code>nuc-model=HKY</code></em>]</code></strong></p>
		<p>Nielsen and Yang (1998)</p>
	      </td><td>Codons</td><td>
		<p><em class="replaceable"><code>nuc-model</code></em> parameters.</p>
		<p><mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" overflow="scroll"><mml:mi>ω</mml:mi></mml:math>: the dn/ds ratio</p>
	      </td><td>
		<p>If the nuc-model has transition matrix
		<mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" overflow="scroll"><mml:msubsup><mml:mi>S</mml:mi> <mml:mrow><mml:mi>ij</mml:mi></mml:mrow> <mml:mo>′</mml:mo></mml:msubsup></mml:math> on nucleotides, then:</p>

		<p><mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" overflow="scroll"><mml:msub><mml:mi>S</mml:mi> <mml:mrow><mml:mi>α</mml:mi><mml:mi>β</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>0 </mml:mn></mml:math> for changes of more than one nucleotide.</p>
		<p><mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" overflow="scroll"><mml:msub><mml:mi>S</mml:mi> <mml:mrow><mml:mi>α</mml:mi><mml:mi>β</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msubsup><mml:mi>S</mml:mi> <mml:mrow><mml:mi>ij</mml:mi></mml:mrow> <mml:mo>′</mml:mo></mml:msubsup></mml:math> for synonymous changes.</p>
		<p><mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" overflow="scroll"><mml:msub><mml:mi>S</mml:mi> <mml:mrow><mml:mi>α</mml:mi><mml:mi>β</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mi>ω</mml:mi><mml:msubsup><mml:mi>S</mml:mi> <mml:mrow><mml:mi>ij</mml:mi></mml:mrow> <mml:mo>′</mml:mo></mml:msubsup></mml:math> for non-synonymous changes.</p>
	      </td></tr></tbody></table></div></div><br class="table-break" /></div></div><div class="sect2" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id315489"></a>8.2. Indel models</h3></div></div></div><p>The current models are simple, fragments, and fragments+T.  The
      default is fragments+T.</p></div><div class="sect2" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id315499"></a>8.3. Alignment constraints</h3></div></div></div><p>To pin columns of the alignment, specify alignment
      constraints in a file as follows: </p><div class="orderedlist"><ol type="1"><li><p>Use the argument
	<strong class="userinput"><code>--align-constraint <em class="replaceable"><code>filename</code></em></code></strong></p></li><li><p>The filename refers to a file in which each
	line represents a constraint.</p></li></ol></div><div class="sect3" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="id315534"></a>8.3.1. Syntax</h4></div></div></div><p>The first line of the file is a header consisting of an
   ordered list of sequence names separated by spaces. Each subsequent line
   consists of a space-separated list of sequence positions, with the first position
   corresponding to the first leaf sequence, the second position
   corresponding to the second leaf sequence, etc. Thus, if there are
   <em class="replaceable"><code>n</code></em> leaf taxa, then each line corresponds to a
   space-separated list of <em class="replaceable"><code>n</code></em> integers.</p></div><div class="sect3" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="id315554"></a>8.3.2. Examples</h4></div></div></div><p>For example, the file</p><pre class="programlisting">A B C
1 2 2</pre><p>implies that position 1 of leaf sequence A is aligned to
      position 2 of leaf sequences B and C. Note that the first
      position in a sequence is position 0.</p><p>Optionally, one may use a '-' instead of an integer, which
      denotes a lack of constraint for that sequence. This can be
      useful as follows:</p><pre class="programlisting">A B C D
2 2 - - 
- - 2 2
</pre><p>The above constraints force alignment between position 2
   of sequences A and B, and between position 2 of sequence C and
   D.</p></div><div class="sect3" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="id315589"></a>8.3.3. Computing the constraints</h4></div></div></div><p>
	  The program <span><strong class="command">alignment-indices</strong></span> may be used
	  to aid in computing a constraint file from an input
	  alignment.  Each line in the resulting file is a constraint 
	  corresponding to one column of the input alignment.
	  Simply remove the constraints that you do not want to keep.
	</p></div></div></div><div class="sect1" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="subst_adv"></a>9. Substitution Models (Advanced)</h2></div></div></div><p>
      Advanced substitution models in <span class="application">BAli-Phy</span>
      are constructed as mixtures of the basic CTMC models (see <a href="#subst_basic" title="8.1.&#xA0;Substitution models (Basic)">Section 8.1, “Substitution models (Basic)”</a>) run at different rates (e.g. <mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" overflow="scroll"><mml:msub><mml:mi>Γ</mml:mi> <mml:mn>4 </mml:mn></mml:msub><mml:mo>+</mml:mo><mml:mi>INV</mml:mi></mml:math>)
      or parameters (e.g. an M2 codon model).
    </p><div class="sect2" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id315653"></a>9.1. Specifying a substitution model</h3></div></div></div><p>Substitution models are specified using a stack, as
	follows:
<strong class="userinput"><code>Model[arg]+Model[arg]+...+Model[arg]</code></strong>
        where each model uses the previous models as input.  Arguments
	are optional.
	</p><p>The basic CTMC models are EQU, HKY, TN, GTR, Empirical, and M0.</p><p>Model modifiers are gamma, log-normal, INV, M2, M3, and M7.</p></div><div class="sect2" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id315678"></a>9.2. CTMC Frequency models</h3></div></div></div><p>The above decomposition can be generalized slightly to
	yield the following decomposition, where <mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" overflow="scroll"><mml:mi>f</mml:mi></mml:math> ranges from <mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" overflow="scroll"><mml:mn>0 </mml:mn></mml:math> to <mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" overflow="scroll"><mml:mn>1 </mml:mn></mml:math>.
	</p><div class="equation"><a id="id315714"></a><p class="title"><b>Equation 0. </b></p><div class="equation-contents"><mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" overflow="scroll"><mml:msub><mml:mi>Q</mml:mi> <mml:mrow><mml:mi>ij</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>S</mml:mi> <mml:mrow><mml:mi>ij</mml:mi></mml:mrow></mml:msub><mml:mo>×</mml:mo><mml:mfrac><mml:mrow><mml:msubsup><mml:mi>π</mml:mi> <mml:mi>j</mml:mi> <mml:mi>f</mml:mi></mml:msubsup></mml:mrow><mml:mrow><mml:msubsup><mml:mi>π</mml:mi> <mml:mi>i</mml:mi> <mml:mrow><mml:mn>1 </mml:mn><mml:mo>-</mml:mo><mml:mi>f</mml:mi></mml:mrow></mml:msubsup></mml:mrow></mml:mfrac><mml:mo>,</mml:mo></mml:math></div></div><p><br class="equation-break" />
	Here the parameter <mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" overflow="scroll"><mml:mi>f</mml:mi></mml:math> specifies the relative importance of
	unequal conservation (<mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" overflow="scroll"><mml:mi>f</mml:mi><mml:mo>=</mml:mo><mml:mn>0 </mml:mn></mml:math>) and unequal replacement (<mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" overflow="scroll"><mml:mi>f</mml:mi><mml:mo>=</mml:mo><mml:mn>1 </mml:mn></mml:math>) in
	maintaining the equilibrium frequencies <mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" overflow="scroll"><mml:mi>π</mml:mi></mml:math>.  
	</p><p>
	In fact, this can be generalized even further to </p><div class="equation"><a id="id315820"></a><p class="title"><b>Equation 0. </b></p><div class="equation-contents"><mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" overflow="scroll"><mml:msub><mml:mi>Q</mml:mi> <mml:mrow><mml:mi>ij</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>S</mml:mi> <mml:mrow><mml:mi>ij</mml:mi></mml:mrow></mml:msub><mml:mo>×</mml:mo><mml:mi>R</mml:mi><mml:mo>(</mml:mo><mml:mi>π</mml:mi><mml:msub><mml:mo>)</mml:mo> <mml:mrow><mml:mi>ij</mml:mi></mml:mrow></mml:msub></mml:math></div></div><p><br class="equation-break" /> where </p><div class="equation"><a id="id315860"></a><p class="title"><b>Equation 0. </b></p><div class="equation-contents"><mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" overflow="scroll"><mml:msub><mml:mi>π</mml:mi> <mml:mi>i</mml:mi></mml:msub><mml:mo>×</mml:mo><mml:msub><mml:mi>R</mml:mi> <mml:mrow><mml:mi>ij</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>π</mml:mi> <mml:mi>j</mml:mi></mml:msub><mml:mo>×</mml:mo><mml:msub><mml:mi>R</mml:mi> <mml:mrow><mml:mi>ji</mml:mi></mml:mrow></mml:msub><mml:mo>.</mml:mo></mml:math></div></div><p><br class="equation-break" />
	</p><p>These models can therefore be expressed as a combination
	of an "exchange model" (for <mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" overflow="scroll"><mml:mi>S</mml:mi></mml:math>) and a "frequency model" (for
	<mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" overflow="scroll"><mml:mi>R</mml:mi></mml:math>).
	</p></div><div class="sect2" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id315929"></a>9.3. Frequency Models</h3></div></div></div><p>
	</p><div class="table"><a id="id315938"></a><p class="title"><b>Table 2. Frequency Models</b></p><div class="table-contents"><table summary="Frequency Models" border="0"><colgroup><col /><col /><col /><col /></colgroup><thead><tr><th>Model</th><th>Alphabet</th><th>Parameters</th><th>Description</th></tr></thead><tbody><tr><td>
		<p><strong class="userinput"><code>pi</code></strong></p>
		<p>Simple frequency model</p>
	      </td><td>any</td><td>
		<p><mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" overflow="scroll"><mml:mi>f</mml:mi></mml:math> (1)</p>
		<p><mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" overflow="scroll"><mml:mi>π</mml:mi></mml:math> (<mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" overflow="scroll"><mml:mo lspace="0em" rspace="0em">∣</mml:mo><mml:mi>α</mml:mi><mml:mo lspace="0em" rspace="0em">∣</mml:mo></mml:math>) </p>
	      </td><td><mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" overflow="scroll"><mml:msub><mml:mi>R</mml:mi> <mml:mrow><mml:mi>ij</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msubsup><mml:mi>π</mml:mi> <mml:mi>j</mml:mi> <mml:mi>f</mml:mi></mml:msubsup></mml:mrow><mml:mrow><mml:msubsup><mml:mi>π</mml:mi> <mml:mi>i</mml:mi> <mml:mrow><mml:mn>1 </mml:mn><mml:mo>-</mml:mo><mml:mi>f</mml:mi></mml:mrow></mml:msubsup></mml:mrow></mml:mfrac></mml:math>.</td></tr><tr><td>
		<p><strong class="userinput"><code>pi=nucleotides</code></strong></p>
		<p>Independent nucleotide frequency model</p>
	      </td><td>Triplets</td><td>
		<p><mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" overflow="scroll"><mml:mi>f</mml:mi></mml:math> (1)</p>
		<p><mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" overflow="scroll"><mml:msub><mml:mi>π</mml:mi> <mml:mi>N</mml:mi></mml:msub></mml:math> (4) </p>
	      </td><td>
		<p><mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" overflow="scroll"><mml:msub><mml:mi>π</mml:mi> <mml:mi>α</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>π</mml:mi> <mml:mi>i</mml:mi></mml:msub><mml:msub><mml:mi>π</mml:mi> <mml:mi>j</mml:mi></mml:msub><mml:msub><mml:mi>π</mml:mi> <mml:mi>k</mml:mi></mml:msub></mml:math></p>
		<p><mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" overflow="scroll"><mml:msub><mml:mi>R</mml:mi> <mml:mrow><mml:mi>α</mml:mi><mml:mi>β</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msubsup><mml:mi>π</mml:mi> <mml:mi>β</mml:mi> <mml:mi>f</mml:mi></mml:msubsup></mml:mrow><mml:mrow><mml:msubsup><mml:mi>π</mml:mi> <mml:mi>α</mml:mi> <mml:mrow><mml:mn>1 </mml:mn><mml:mo>-</mml:mo><mml:mi>f</mml:mi></mml:mrow></mml:msubsup></mml:mrow></mml:mfrac></mml:math>.</p>
	      </td></tr><tr><td>
		<p><strong class="userinput"><code>pi=amino-acids</code></strong></p>
		<p>Amino-acid based codon frequencies. (no codon bias)</p>
	      </td><td>Codons</td><td>
		<p><mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" overflow="scroll"><mml:mi>f</mml:mi></mml:math> (1)</p>
		<p><mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" overflow="scroll"><mml:msub><mml:mi>π</mml:mi> <mml:mrow><mml:mi>AA</mml:mi></mml:mrow></mml:msub></mml:math> (20)</p>
	      </td><td><mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" overflow="scroll"><mml:msub><mml:mi>R</mml:mi> <mml:mrow><mml:mi>ij</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msubsup><mml:mi>π</mml:mi> <mml:mi>j</mml:mi> <mml:mi>f</mml:mi></mml:msubsup></mml:mrow><mml:mrow><mml:msubsup><mml:mi>π</mml:mi> <mml:mi>i</mml:mi> <mml:mrow><mml:mn>1 </mml:mn><mml:mo>-</mml:mo><mml:mi>f</mml:mi></mml:mrow></mml:msubsup></mml:mrow></mml:mfrac></mml:math>.</td></tr></tbody></table></div></div><br class="table-break" /></div><div class="sect2" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id316383"></a>9.4. CTMC Mixture Models</h3></div></div></div><div class="table"><a id="id316396"></a><p class="title"><b>Table 3. Extended Model Descriptions</b></p><div class="table-contents"><table summary="Extended Model Descriptions" border="0"><colgroup><col /><col /><col /><col /></colgroup><tbody><tr><td>
		<p><strong class="userinput"><code><em class="replaceable"><code>sm</code></em> + INV</code></strong></p>
	      </td><td><em class="replaceable"><code>sm</code></em> alphabet</td><td>
		<p><mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" overflow="scroll"><mml:mi>p</mml:mi></mml:math>: invariant fraction.</p>
	      </td><td>
	      <p>A fraction <mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" overflow="scroll"><mml:mi>p</mml:mi></mml:math> of sites do not allow substitutions.</p>
	      </td></tr><tr><td>
		<p><strong class="userinput"><code><em class="replaceable"><code>sm</code></em> + gamma[<mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" overflow="scroll"><mml:mi>n</mml:mi></mml:math>]</code></strong></p>
		<p>Yang (1994)</p>
	      </td><td><em class="replaceable"><code>sm</code></em> alphabet</td><td>
		<p><mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" overflow="scroll"><mml:mi>σ</mml:mi><mml:mo>/</mml:mo><mml:mi>μ</mml:mi></mml:math>: noise to signal ratio for <mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" overflow="scroll"><mml:mi>Γ</mml:mi></mml:math>.</p>
	      </td><td>
	      <p>rate <mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" overflow="scroll"><mml:mo>∼</mml:mo><mml:mi>Γ</mml:mi><mml:mo>(</mml:mo><mml:mi>μ</mml:mi><mml:mo>=</mml:mo><mml:mn>1 </mml:mn><mml:mo>,</mml:mo><mml:mi>σ</mml:mi><mml:mo>)</mml:mo></mml:math>.</p>
	      <p>A discrete approximation to the <mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" overflow="scroll"><mml:mi>Γ</mml:mi></mml:math> with <mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" overflow="scroll"><mml:mi>n</mml:mi></mml:math>
     	            bins is used.</p>
	      </td></tr><tr><td>
		<p><strong class="userinput"><code><em class="replaceable"><code>sm</code></em> + log-normal[<mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" overflow="scroll"><mml:mi>n</mml:mi></mml:math>]</code></strong></p>
	      </td><td><em class="replaceable"><code>sm</code></em> alphabet</td><td>
		<p><mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" overflow="scroll"><mml:mi>σ</mml:mi><mml:mo>/</mml:mo><mml:mi>μ</mml:mi></mml:math>: noise to signal ratio for <mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" overflow="scroll"><mml:mi>log</mml:mi><mml:mi>Normal</mml:mi></mml:math>.</p>
	      </td><td>
	      <p>rate <mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" overflow="scroll"><mml:mo>∼</mml:mo><mml:mi>log</mml:mi><mml:mi>Normal</mml:mi><mml:mo>(</mml:mo><mml:mi>μ</mml:mi><mml:mo>=</mml:mo><mml:mn>1 </mml:mn><mml:mo>,</mml:mo><mml:mi>σ</mml:mi><mml:mo>)</mml:mo></mml:math>.</p>
	      <p>A discrete approximation to the <mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" overflow="scroll"><mml:mi>log</mml:mi><mml:mi>Normal</mml:mi></mml:math> with <mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" overflow="scroll"><mml:mi>n</mml:mi></mml:math>
     	            bins is used.</p>
	      </td></tr><tr><td>
		<p><strong class="userinput"><code>M2</code></strong></p>
		<p><strong class="userinput"><code><em class="replaceable"><code>sm</code></em> + M2</code></strong></p>
		<p>Yang, et. al. (2000)</p>
	      </td><td>Codons</td><td>
		<p><mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" overflow="scroll"><mml:mi>κ</mml:mi></mml:math>: the ts/tv ratio</p>
		<p><mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" overflow="scroll"><mml:msub><mml:mi>p</mml:mi> <mml:mn>1 </mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>p</mml:mi> <mml:mn>2 </mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>p</mml:mi> <mml:mn>3 </mml:mn></mml:msub></mml:math>: bin frequencies.</p>
		<p><mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" overflow="scroll"><mml:msub><mml:mi>ω</mml:mi> <mml:mn>3 </mml:mn></mml:msub></mml:math>: value of <mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" overflow="scroll"><mml:mi>ω</mml:mi></mml:math> in bin 2.</p>
	      </td><td>
	      <p><mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" overflow="scroll"><mml:mi>Ω</mml:mi><mml:mo>=</mml:mo><mml:msub><mml:mi>ω</mml:mi> <mml:mi>i</mml:mi></mml:msub></mml:math> with probability <mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" overflow="scroll"><mml:msub><mml:mi>p</mml:mi> <mml:mi>i</mml:mi></mml:msub></mml:math>.</p>
	      <p><mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" overflow="scroll"><mml:msub><mml:mi>ω</mml:mi> <mml:mn>1 </mml:mn></mml:msub><mml:mo>=</mml:mo><mml:mn>0 </mml:mn></mml:math>, <mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" overflow="scroll"><mml:msub><mml:mi>ω</mml:mi> <mml:mn>2 </mml:mn></mml:msub><mml:mo>=</mml:mo><mml:mn>1 </mml:mn></mml:math>.</p>
	      <p>The default for <em class="replaceable"><code>sm</code></em> is M0.</p>
	      </td></tr><tr><td>
		<p><strong class="userinput"><code>M3[<mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" overflow="scroll"><mml:mi>n</mml:mi></mml:math>]</code></strong></p>
		<p><strong class="userinput"><code><em class="replaceable"><code>sm</code></em> + M3[<mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" overflow="scroll"><mml:mi>n</mml:mi></mml:math>]</code></strong></p>
		<p>Yang, et. al. (2000)</p>
	      </td><td>Codons</td><td>
		<p><mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" overflow="scroll"><mml:mi>κ</mml:mi></mml:math>: the ts/tv ratio</p>
		<p><mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" overflow="scroll"><mml:msub><mml:mi>p</mml:mi> <mml:mn>1 </mml:mn></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mi>p</mml:mi> <mml:mi>n</mml:mi></mml:msub></mml:math>: bin frequencies.</p>
		<p><mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" overflow="scroll"><mml:msub><mml:mi>ω</mml:mi> <mml:mn>1 </mml:mn></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mi>ω</mml:mi> <mml:mi>n</mml:mi></mml:msub></mml:math>: values of <mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" overflow="scroll"><mml:mi>ω</mml:mi></mml:math>.</p>
	      </td><td>
	      <p><mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" overflow="scroll"><mml:mi>Ω</mml:mi><mml:mo>=</mml:mo><mml:msub><mml:mi>ω</mml:mi> <mml:mi>i</mml:mi></mml:msub></mml:math> with probability <mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" overflow="scroll"><mml:msub><mml:mi>p</mml:mi> <mml:mi>i</mml:mi></mml:msub></mml:math>.</p>
	      </td></tr><tr><td>
		<p><strong class="userinput"><code>M7[<mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" overflow="scroll"><mml:mi>n</mml:mi></mml:math>]</code></strong></p>
		<p><strong class="userinput"><code><em class="replaceable"><code>sm</code></em> + M7[<mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" overflow="scroll"><mml:mi>n</mml:mi></mml:math>]</code></strong></p>
		<p>Yang, et. al. (2000)</p>
	      </td><td>Codons</td><td>
		<p><mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" overflow="scroll"><mml:mi>μ</mml:mi></mml:math>: mean of the Beta distribution.</p>
		<p><mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" overflow="scroll"><mml:mi>σ</mml:mi><mml:mo>/</mml:mo><mml:mi>μ</mml:mi></mml:math>: noise to signal ratio for Beta.</p>
	      </td><td>
	      <p><mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" overflow="scroll"><mml:mi>Ω</mml:mi><mml:mo>∼</mml:mo><mml:mi>Beta</mml:mi><mml:mo>(</mml:mo><mml:mi>μ</mml:mi><mml:mo>,</mml:mo><mml:mi>σ</mml:mi><mml:mo>)</mml:mo></mml:math>.</p>
	      <p>A discrete approximation to the Beta with <mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" overflow="scroll"><mml:mi>n</mml:mi></mml:math>
     	            bins is used.</p>
	      </td></tr></tbody></table></div></div><br class="table-break" /></div><div class="sect2" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id317180"></a>9.5. Examples</h3></div></div></div><p>Example: --smodel EQU --alphabet Triplets</p><p>Example: --smodel HKY</p><p>Example: --smodel TN+pi=constant</p><p>Example: --smodel Empirical[WAG]+log-normal+INV</p><p>Example: --smodel M0 --alphabet Codons</p><p>Example: --smodel M0+pi=nucleotides --alphabet Codons</p><p>Example: --smodel M2 --alphabet Codons</p><p>Example: --smodel M0[TN]+M2 --alphabet Codons</p></div></div><div class="sect1" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id317217"></a>10. Output</h2></div></div></div><div class="sect2" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id317222"></a>10.1. Output directory</h3></div></div></div><p><span class="application">BAli-Phy</span> creates a new
      directory to store its output files each time it is run.  By default, the
      directory name is the name of the sequence file, with a number
      added on the end to make it unique. <span class="application">BAli-Phy</span>
      first checks  if there is already a directory called
      <code class="filename"><em class="replaceable"><code>file</code></em>-1/</code>, and then moves on to
      <code class="filename"><em class="replaceable"><code>file</code></em>-2/</code>, etc. until it finds an
      unused directory name.</p><p>You can specify a different name to use instead of the
      sequence-file name by using the <strong class="userinput"><code>--name</code></strong> option.</p></div><div class="sect2" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id317272"></a>10.2. Output files</h3></div></div></div><p><span class="application">BAli-Phy</span> produces the following output
      files inside the directory that it creates:</p><div class="variablelist"><table border="0"><col align="left" valign="top" /><tbody><tr><td><span class="term">1.out</span></td><td><p>Iteration numbers, alignments, and probabilities.</p></td></tr><tr><td><span class="term">1.err</span></td><td><p>Success probabilities for transition kernels.</p></td></tr><tr><td><span class="term">1.MAP</span></td><td><p>Successive estimates of the MAP point</p></td></tr><tr><td><span class="term">1.p</span></td><td><p>Scalar parameters: indel and substitution parameters, etc.</p></td></tr><tr><td><span class="term">1.trees</span></td><td><p>Tree samples</p></td></tr></tbody></table></div><p>For the last two files, each line in these files corresponds to one iteration.</p></div></div><div class="sect1" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="mixing_and_convergence"></a>11. Convergence and Mixing: Is it done yet?</h2></div></div></div><p>
      When using Markov chain Monte Carlo (MCMC) programs like
      <span class="application">MrBayes</span>, <span class="application">BEAST</span> or
      <span class="application">BAli-Phy</span>, one of the key questions is
      how many iterations are required to give a good estimate.
      Unfortunately, this question is complicated and depends upon
      both the problem and the specific data set that is being
      examined.  As a result, <span class="application">BAli-Phy</span>
      relies on the user to determines when enough samples have been
      obtained - and to terminate the program when this happens. 
    </p><p>
      In general, we recommend that you analyze the data from a
      running chain periodically and repeatedly in order to determine
      when to stop it.
    </p><p>
      To inspect the Markov chain generated by
      <span class="application">BAli-Phy</span>, we recommend the program
      <a href="http://evolve.zoo.ox.ac.uk/software/tracer/" target="_top">Tracer</a>. 
      You can open the file <code class="filename">1.p</code> in Tracer to view
      traceplots and to estimate the effective sample size.  However,
      these techniques that work well for numerical parameters do not
      work well for objects such as trees and alignments.  Therefore,
      the full analysis is necessary as well (<a href="#analysis" title="12.&#xA0;Analyzing the output">Section 12, “Analyzing the output”</a>).
    </p><div class="sect2" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id317438"></a>11.1. Convergence</h3></div></div></div><div class="sect3" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="id317443"></a>11.1.1. Definition</h4></div></div></div><p>
	  What is convergence, and how can you check if a Markov chain
	  has "converged"?  We first note that "convergence" refers to
	  the tendency of a Markov chain to converge to the desired
	  distribution (its equilibrium distribution).  The Markov chain starts at a
	  specific tree and alignment, which may not be representative
	  of the equilibrium distribution, and so convergence
	  represents the process of "forgetting" the starting value.
	  If we represent the i-th iteration of the Markov chain as
	  X[i], then we desire rapid convergence of the distribution
	  of X[i] to the equilibrium distribution.
	</p></div><div class="sect3" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="id317458"></a>11.1.2. Burn-in</h4></div></div></div><p>
	  In practice, most MCMC analyses designate some number of
	  samples at the beginning of each chain as "burn-in".  These
	  samples are discarded because they represent the initial
	  starting point, but not the equilibrium distribution.
	</p><p>
	  Determining the number of samples to discard as burn-in is
	  usually rather ad-hoc.  MCMC practitioners often run the
	  chain for a "long" time, and then visually inspect the
	  samples, perhaps using <a href="http://evolve.zoo.ox.ac.uk/software/tracer/" target="_top">Tracer</a>. After some number of iterations, the 
	  samples become "typical" of later values, and that number
	  is chosen as the burn-in.  Unfortunately, it is always
	  possible that if you run the Markov chain even longer, then
	  the values will change again.  Therefore, this method is not
	  strong evidence that a chain converges before a given burn-in time.
	</p></div><div class="sect3" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="id317485"></a>11.1.3. Testing Convergence</h4></div></div></div><p>
	  A better (but not perfect) test of convergence is to run
	  several independant chains starting from many different
	  places.  It is possible that each Markov chain will get
	  stuck in local optima near its own starting value, but that
	  the movement between the different local optima will be
	  exceedingly slow.  However, if the posterior distributions
	  from each Markov chain seem to be the same, then that gives some
	  evidence that the MCMC procedure is truly converging to a
	  global equilibrium.
	</p></div></div><div class="sect2" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id317500"></a>11.2. Mixing</h3></div></div></div><div class="sect3" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="id317506"></a>11.2.1. Definition</h4></div></div></div><p>
	  In MCMC, each sample is not fully independent of previous
	  samples.  In fact, a Markov chain can get "stuck" in one part
	  of the parameter space for a long time, before jumping to an
	  equally important part.  When this happens, we say that the
	  chain isn't "mixing" well.
	</p></div><div class="sect3" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="id317518"></a>11.2.2. Measures: how good is the mixing?</h4></div></div></div><p>
	  For continuous parameters, one common measure is the
	  effective sample size (ESS).  Given a collection of
	  <span class="emphasis"><em>dependent</em></span> samples from a Markov chain,
	  the effective sample size is the equivalent number of
	  <span class="emphasis"><em>independent</em></span> samples.  However, there
	  are many ways one could measure "equivalence".  The usual
	  way is to compare samples based on the variance of the sum
	  of the values.
	</p></div></div></div><div class="sect1" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="analysis"></a>12. Analyzing the output</h2></div></div></div><p>
	In addition to running the full analysis, it will be helpful
	to analyze the numerical parameters using
	<span class="application">Tracer</span> (<a href="#mixing_and_convergence" title="11.&#xA0;Convergence and Mixing: Is it done yet?">Section 11, “Convergence and Mixing: Is it done yet?”</a>).  The full analysis should
	be run repeatedly as the simulation progresses, to determine
	when enough samples have been collected.
      </p><div class="sect2" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id317567"></a>12.1. How to run the full analysis</h3></div></div></div><p>
      First, enter the output directory.  Then make a local copy of
      the the analysis makefile:
</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>cp <em class="replaceable"><code>prefix</code></em>/share/doc/bali-phy/GNUmakefile .</code></strong></pre><p>
      Here, <em class="replaceable"><code>prefix</code></em> is the directory where
      you installed <span class="application">BAli-Phy</span>.
      </p><p>After you have installed the analysis makefile, run the command:

      </p><pre class="screen"> <code class="prompt">%</code> <strong class="userinput"><code>SKIP=<em class="replaceable"><code>burn-in</code></em> make</code></strong></pre><p>

      or

      </p><pre class="screen"> <code class="prompt">%</code> <strong class="userinput"><code>SKIP=<em class="replaceable"><code>burn-in</code></em> SIZE=<em class="replaceable"><code>iterations</code></em> make</code></strong></pre><p>

      Here, <em class="replaceable"><code>burn-in</code></em> represents the
      number of iterations to skip as burn-in, and
      <em class="replaceable"><code>iterations</code></em> represents the maximum
      number of iterations to use in the analysis. In order for this
      to work, the directory containing the
      <span class="application">BAli-Phy</span> tools must be in your PATH.
      </p><p>Running the analysis will produce the three directories:
      <code class="filename">Results/</code>, <code class="filename">Mixing/</code>, and
      <code class="filename">Work/</code>.  The <code class="filename">Results/</code>
      directory contains tree and alignment estimates and confidence
      levels.   The <code class="filename">Mixing/</code> directory contains various
      measures of whether the chain ran long enough given its Mixing.
      The <code class="filename">Work/</code> directory contains various
      intermediate files that you probably do not need.</p></div><div class="sect2" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id317710"></a>12.2. Results/</h3></div></div></div><p>Running the above command will produce the following files in
	the <code class="filename">Results/</code> directory:</p><div class="variablelist"><table border="0"><col align="left" valign="top" /><tbody><tr><td><span class="term">analysis</span></td><td><p>A description of the analysis:  burn-in, length, time completed.
	</p></td></tr><tr><td><span class="term">Report</span></td><td><p>A summary of results: posterior means and credible intervals,
	etc..</p></td></tr><tr><td><span class="term">consensus</span></td><td><p>Summary of MAP and consensus topologies, as well as supported
	partitions (clades). </p></td></tr><tr><td><span class="term">c-levels.plot</span></td><td><p>The number of partitions (clades) supported at each LOD level.</p></td></tr><tr><td><span class="term">c<em class="replaceable"><code>level</code></em>.topology</span></td><td><p>The consensus topology at level
	<em class="replaceable"><code>level</code></em> (Newick format)</p></td></tr><tr><td><span class="term">c<em class="replaceable"><code>level</code></em>.tree</span></td><td><p>The majority consensus topology + branch lengths (Newick format)</p></td></tr><tr><td><span class="term">MAP.topology</span></td><td><p>An estimate of the MAP tree (Newick format)</p></td></tr><tr><td><span class="term">MAP.tree</span></td><td><p>An estimate of the MAP topology + branch lengths (Newick format)</p></td></tr><tr><td><span class="term">MAP.fasta</span></td><td><p>An estimate of the MAP alignment, w/ taxa sorted by similarity.
	</p></td></tr><tr><td><span class="term">MAP.phy</span></td><td><p>An estimate of the MAP alignment, w/ taxa sorted by similarity.
	</p></td></tr></tbody></table></div><p> 
	In addition, the following files will be generated to summarize alignment uncertainty, unless the analysis uses a fixed alignment.

      </p><div class="variablelist"><table border="0"><col align="left" valign="top" /><tbody><tr><td><span class="term">MAP-AU.html</span></td><td><p>An AU plot of the MAP alignment (rainbow color-cheme).
	</p></td></tr><tr><td><span class="term">MAP-AU2.html</span></td><td><p>An AU plot of the MAP alignment (AA/DNA color-scheme).
	</p></td></tr><tr><td><span class="term">MAP-AU.prob</span></td><td><p>The probabilities for each letter in the MAP alignment AU plot.
	</p></td></tr><tr><td><span class="term">consensus.fasta</span></td><td><p>A consensus alignment, representing information shared by most alignment samples.
	</p></td></tr><tr><td><span class="term">consensus-AU.html</span></td><td><p>An AU plot of the consensus alignment (rainbow color-scheme).
	</p></td></tr><tr><td><span class="term">consensus-AU2.html</span></td><td><p>An AU plot of the MAP alignment (AA/DNA color-scheme).
	</p></td></tr><tr><td><span class="term">consensus-AU.prob</span></td><td><p>The probabilities for each letter in the consensus alignment AU plot.
	</p></td></tr></tbody></table></div><div class="sect3" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="consensus"></a>12.2.1. <code class="filename">Results/consensus</code>: partition support</h4></div></div></div><p>
	  This file reports the support of each bi-partition in terms
	  of its posterior probability (PP) and posterior log-10 odds
	  (LOD).

	  Only partitions with PP&gt;0.5 are shown by default.
	</p></div></div><div class="sect2" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id317930"></a>12.3. Mixing/</h3></div></div></div><p>In addition, the following files will be produced in the
      <code class="filename">Mixing/</code> directory:</p><p></p><div class="variablelist"><table border="0"><col align="left" valign="top" /><tbody><tr><td><span class="term">partitions.bs</span></td><td><p>Confidence intervals on the support for partitions, generated
	using a block bootstrap.</p></td></tr><tr><td><span class="term">partitions.SRQ</span></td><td><p>A collection of
	SRQ plots for the supported partitions.
    </p></td></tr><tr><td><span class="term">c50.SRQ</span></td><td><p>An
	SRQ plot for the majority consensus tree.
    </p></td></tr></tbody></table></div><p>The SRQ plots can be viewed by typing "<strong class="userinput"><code>plot
      '<em class="replaceable"><code>file</code></em>' with lines</code></strong>" in
      <span class="application">gnuplot</span>.</p><div class="sect3" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="id317997"></a>12.3.1. <code class="filename">Mixing/partitions.bs</code>: partition mixing</h4></div></div></div><p>
	This file reports the quality of estimates of support for each
	partition,in terms of the auto-correlation time (ACT),
	effective sample size (Ne), and a 95% confidence interval for
	posterior probability (PP) and log-10 odds (LOD).  It also
	reports the number of samples that support (1) or do not
	support (0) the partition, as well as the number of regenerations.

	Only partitions with PP&gt;0.5 are shown by default.
      </p></div></div></div><div class="sect1" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id318018"></a>13. Tuning the Markov Chain</h2></div></div></div><p>These parameters can be set using the command line syntax "<strong class="userinput"><code>--set <em class="replaceable"><code>parameter</code></em>=<em class="replaceable"><code>value</code></em></code></strong>".</p><div class="sect2" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id318039"></a>13.1. Parameters</h3></div></div></div><p>

	</p><div class="table"><a id="id318047"></a><p class="title"><b>Table 4. Tunable Parameters</b></p><div class="table-contents"><table summary="Tunable Parameters" border="0"><colgroup><col /><col /><col /><col /></colgroup><thead><tr><th>Name</th><th>Variable</th><th>Default</th><th>Meaning</th></tr></thead><tbody><tr><td>log_branch_sigma</td><td>branch lengths</td><td>0.6</td><td>Scale of log-proposal.</td></tr><tr><td>branch_sigma</td><td>branch lengths</td><td>0.6</td><td>Scale of non-log-proposal.</td></tr><tr><td>mu_scale_sigma</td><td>mu</td><td>0.6</td><td>Width of proposal on log scale.</td></tr><tr><td>kappa_scale_sigma</td><td>HKY::kappa, TN::kappa(pur), TN::kappa(pyr)</td><td>0.3</td><td>Width of proposal on log scale.</td></tr><tr><td>omega_scale_sigma</td><td>M0::omega, M2::omega</td><td>0.3</td><td>Width of proposal on log scale.</td></tr><tr><td>beta::mu_scale_sigma</td><td>beta::mu</td><td>0.2</td><td>Width of proposal.</td></tr><tr><td>INV::p_shift_sigma</td><td>INV::p</td><td>0.03</td><td>Width of proposal.</td></tr><tr><td>gamma::sigma_scale_sigma</td><td>gamma::sigma/mu</td><td>0.25</td><td>Width of proposal of log scale.</td></tr><tr><td>pi_dirichlet_N</td><td>pi*</td><td>1.0</td><td>Tightness of dirichlet proposal for frequencies.</td></tr><tr><td>lambda_shift_sigma</td><td>delta, lambda</td><td>0.35</td><td>Width of proposal.</td></tr><tr><td>epsilon_shift_sigma</td><td>epsilon</td><td>0.15</td><td>Width of proposal.</td></tr></tbody></table></div></div><p><br class="table-break" />
      </p></div></div><div class="sect1" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id318308"></a>14. Auxiliary tools</h2></div></div></div><p>Most of these tools will describe their options if given the "<strong class="userinput"><code>--help</code></strong>" argument on the command line.</p><div class="sect2" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id318324"></a>14.1. alignment-find</h3></div></div></div><p>Usage: alignment-find [OPTIONS] &lt; <em class="replaceable"><code>alignments-file</code></em></p><p>Find the last (or first) FASTA alignment in a file.</p></div><div class="sect2" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id318340"></a>14.2. alignment-draw</h3></div></div></div><p>alignment-draw <em class="replaceable"><code>alignment-file</code></em> [<em class="replaceable"><code>AU-file</code></em>] [OPTIONS]</p><p>Draw an alignment to HTML, optionally coloring residues by AU.</p></div><div class="sect2" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id318362"></a>14.3. alignment-thin</h3></div></div></div><p>alignment-thin <em class="replaceable"><code>alignment-file</code></em> <em class="replaceable"><code>tree-file</code></em> [OPTIONS]</p><p>Remove taxa from an alignment to preserve the most
      sequence diversity, as measured by the  total length of the tree
      for the remaining taxa.</p></div><div class="sect2" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id318383"></a>14.4. alignment-chop-internal</h3></div></div></div><p>alignment-chop-internal <em class="replaceable"><code>alignment-file</code></em> [OPTIONS]</p><p>Remove ancestral sequences from an alignment.  (This
      probably only works for alignments output by bali-phy.) </p></div><div class="sect2" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id318402"></a>14.5. alignment-info</h3></div></div></div><p>alignment-info <em class="replaceable"><code>alignment-file</code></em> <em class="replaceable"><code>tree-file</code></em> [OPTIONS]</p><p>Display basic information about the alignment, including
      its length, the number of sequences, columns that are constant
      or informative, letter frequencies, etc.</p><p>If a tree is supplied, then the unweighted parsimony score
      is given as well.</p></div><div class="sect2" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id318428"></a>14.6. alignment-indices</h3></div></div></div><p>alignment-indices <em class="replaceable"><code>alignment-file</code></em> [OPTIONS]</p><p>Show the alignment in terms of the index of each character
      in its sequence.  Each line in this file corresponds to one
      alignment column.  This can be useful in producing alignment
      constraint files.</p></div><div class="sect2" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id318447"></a>14.7. alignment-cat</h3></div></div></div><p>alignment-cat <em class="replaceable"><code>file1</code></em>
      [<em class="replaceable"><code>file2</code></em> ...]</p><p>Concatenate several alignments (with the same sequence
      names) end-to-end.</p></div><div class="sect2" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id318468"></a>14.8. trees-consensus</h3></div></div></div><p>Usage: trees-consensus <em class="replaceable"><code>file</code></em>
      [OPTIONS] </p><p>This program analyzes the tree sample contained in
      <em class="replaceable"><code>file</code></em>.  It reports the MAP topology, the
      supported taxa partitions (including partial partitions), and the
      majority consensus topology.
      </p></div><div class="sect2" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id318491"></a>14.9. trees-bootstrap</h3></div></div></div><p>Usage: trees-bootstrap <em class="replaceable"><code>file1</code></em>
      [<em class="replaceable"><code>file2</code></em> ... ] --predicates
      <em class="replaceable"><code>predicate-file</code></em> [OPTIONS] </p><p>This program analyzes the tree samples contained in
      <em class="replaceable"><code>file1</code></em>, <em class="replaceable"><code>file2</code></em>,
      etc.  It gives the support of each tree sample for each predicate in
      <em class="replaceable"><code>predicate-file</code></em>, and reports a confidence
      interval based on the block bootstrap.
      </p><p>Each predicate is the intersection of a set of partitions, and
      is specified as a list of partitions or (multifurcating) trees, one
      per line.  Predicates are separated by blank lines.
      </p></div><div class="sect2" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id318533"></a>14.10. trees-to-SRQ</h3></div></div></div><p>Usage: trees-to-SRQ <em class="replaceable"><code>predicate-file</code></em> [OPTIONS] <em class="replaceable"><code>trees-file</code></em> </p><p>This program analyzes the tree samples contained in
      <em class="replaceable"><code>trees-file</code></em>.  It uses them to produce an
      SRQ plot for each predicate in
      <em class="replaceable"><code>predicate-file</code></em>.  Plots are produced in
      <span class="application">gnuplot</span> format, with one point per line
      and with plots separated by a blank line.</p><p>If <strong class="userinput"><code>--mode sum </code></strong> is specified, then a "sum"
      plot is produced instead of an SRQ plot.  In this plot, the slope of
      the curve corresponds to the posterior probability of the event.  If the
      <strong class="userinput"><code>--invert</code></strong> option is used then the slope of the
      curve correspond to the probability of the inverse event.  This is
      recommended if the probability of the event is near 1.0, because the
      sum plot does not distinguish variation in probabilities near 1.0 well.
      </p></div></div><div class="sect1" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id318589"></a>15. Frequently Asked Questions (FAQ)</h2></div></div></div><div class="sect2" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id318595"></a>15.1. Running <span><strong class="command">bali-phy</strong></span>.</h3></div></div></div><div class="qandaset"><dl><dt>15.1.1. <a href="#id318608">Can I fix the alignment?</a></dt></dl><table border="0" summary="Q and A Set"><col align="left" width="1%" /><tbody><tr class="question"><td align="left" valign="top"><a id="id318608"></a><a id="id318610"></a><b>15.1.1.</b></td><td align="left" valign="top"><p>Can I fix the alignment?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>Yes.  Add <strong class="userinput"><code>-t</code></strong> or <strong class="userinput"><code>--traditional</code></strong> on the command line.</p></td></tr></tbody></table></div></div><div class="sect2" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id318637"></a>15.2. Stopping <span><strong class="command">bali-phy</strong></span>.</h3></div></div></div><div class="qandaset"><dl><dt>15.2.1. <a href="#id318650">Why is bali-phy still
	running? How long will it take?</a></dt><dt>15.2.2. <a href="#id318671">So, how can I know when to stop it?</a></dt><dt>15.2.3. <a href="#id318686">How can you tell when the chain has converged?</a></dt><dt>15.2.4. <a href="#id318712">How can I check how many iterations the chain
	has finished?</a></dt></dl><table border="0" summary="Q and A Set"><col align="left" width="1%" /><tbody><tr class="question"><td align="left" valign="top"><a id="id318650"></a><a id="id318652"></a><b>15.2.1.</b></td><td align="left" valign="top"><p>Why is <span><strong class="command">bali-phy</strong></span> still
	running? How long will it take?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>It runs until you stop it.  Stop it when its
	  done.</p></td></tr><tr class="question"><td align="left" valign="top"><a id="id318671"></a><a id="id318673"></a><b>15.2.2.</b></td><td align="left" valign="top"><p>So, how can I know when to stop it?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>You can stop when it has both converged and also run for long enough to give
	  you &gt;1000 effectively independent samples.  </p></td></tr><tr class="question"><td align="left" valign="top"><a id="id318686"></a><a id="id318688"></a><b>15.2.3.</b></td><td align="left" valign="top"><p>How can you tell when the chain has converged?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>It depends on the data set.  To test convergence, run at
	  least 4 independent chains (preferably 10) from different
	  random starting points and see if the posterior
	  distributions for each chain are the same. 
	  </p><p>Unfortunately, when the distributions all seem to be this same, this doesn't <span class="emphasis"><em>prove</em></span> that they have all converged to the equilibrium distribution.  However, if the distributions are different then you can reject either convergence or good mixing. </p></td></tr><tr class="question"><td align="left" valign="top"><a id="id318712"></a><a id="id318714"></a><b>15.2.4.</b></td><td align="left" valign="top"><p>How can I check how many iterations the chain
	has finished?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>Run <span><strong class="command">wc -l 1.p</strong></span> inside the output
	  directory, and subtract 2.
	  </p></td></tr></tbody></table></div></div><div class="sect2" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id318735"></a>15.3. Interpreting the results.</h3></div></div></div><div class="qandaset"><dl><dt>15.3.1. <a href="#id318743">Where can I find the clade support?</a></dt><dt>15.3.2. <a href="#id318759">Where can I find the partition support?</a></dt></dl><table border="0" summary="Q and A Set"><col align="left" width="1%" /><tbody><tr class="question"><td align="left" valign="top"><a id="id318743"></a><a id="id318745"></a><b>15.3.1.</b></td><td align="left" valign="top"><p>Where can I find the clade support?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>Actually, BAli-Phy uses unrooted trees, so it only estimates bi-partition support.  A bi-partition is a division of taxa into two groups, but it does not specify which group contains the root. </p></td></tr><tr class="question"><td align="left" valign="top"><a id="id318759"></a><a id="id318761"></a><b>15.3.2.</b></td><td align="left" valign="top"><p>Where can I find the partition support?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>After you analyze the output (<a href="#analysis" title="12.&#xA0;Analyzing the output">Section 12, “Analyzing the output”</a>), the partition support is indicated in
	  <code class="filename">Results/consensus</code>.  (see <a href="#consensus" title="12.2.1.&#xA0;Results/consensus: partition support">Section 12.2.1, “<code class="filename">Results/consensus</code>: partition support”</a>. </p></td></tr></tbody></table></div></div></div></div></body></html>
