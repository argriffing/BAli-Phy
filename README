We will use square brackes (e.g. []) to represent example arguments,
which you must replace with the actual argument.  We will use curly
branches (e.g. {}) to represent a list of possbility choices.

In order to run the program, note that in many cases it is
necessary to specify the location of the data directory.  The data
directory will be "./Data" it not explicitly set. (See "datadir").

The simplest ways to run bali-phy is simply to specify some input
sequences:  

% bali-phy align=[file.fasta]

The "align" argument is the only REQUIRED argument, and can take both
FASTA (*.fasta) and PHYLIP (*.phy) files.  The file must contain one
of these two suffixes or it won't know how to read the file.

OTHER ARGUMENTS

 - tree=[treefile]   

   Specifies the INITIAL tree. The treefile must be in Newick
   format), and end with a semicolon. 

 - gaps=star         

   Revert to the standard model, w/o gaps.  This turns off MCMC
   transition kernels which assume a gap model.

 - smodel=[substitution model]

   The model is follows the following pattern: [base model]+gamma+INV
   Each term may be left out, but the terms must be separated by '+'
   signs, and must appear in the specified order.

   The base model is a reversible continuous time Markov chain (CTMC)
   model.  Base models that we have implemented include HKY, EQU,
   YangCodonModel, and empirically estimated reversible models
   such as the WAG model.  See the 'Empirical' parameter to specify
   the transition matrix. 
   
 - alphabet=Codons

   This puts codon alphabets on the list of alphabets to try.

 - frequencies=[frequences]

   Frequencies are specified as a comma-separated list of values.
   Note that frequencies that are very near 0 can cause a crash
   in exponentiating the rate matrix.

 - Empirical=[model]

   This causes the program to look in the file [datadir]/[model].dat
   for the exchangeability parameters of the Q matrix used in the
   Empirical model.

 - datadir=[dir]

   This is set to "./Data/" by default, and specifies where to look
   for translation tables (for the codon model) and empirical
   transition matrices.

 - s_parameters=[parameters]

   Specifies the INITIAL value of the parameters of the substitution
   model.  This is a comma-separated list of values.

 - g_parameters=[parameters]

   Specifies the INITIAL value of the parameters of the indel
   model.  This is a comma-separated list of values.

 - letters=star

   Uses a star tree for the peeling algorithm.

 - randomize_alignment

   Randomizes the alignment before starting the chain.

 - seed=[random seed]

   Specify a seed to the random number generator, so that runs can be
   repeated. 

 - lambda_O=[value]

   Specify the gap opening penalty.  This is ln(delta)

 - lambda_E=[value]

   Specify the gap extension penalty.  This is ln(epsilon)

 - imodel={single_indels,upweighted}

   Select the indel model.  We used "upweighted" in our paper.  The
   "single_indels" model assumes all indels are of unit length.

 - internal=+

   Set each internal sequence to * (a Felsenstein wildcard) in every
   column. 

 - file=[filename]

   Load additional arguments from a file.  Giving '-' reads from
   stdin.  This is a way to make scripts.

 - disable=[list of transition kernels]
 - enable=[list of transition kernels]

   Disables or enables a list of transition kernels.  To find out
   kernel names, look at STDOUT at the beginning of a run.  Moves also
   have attributes by which they can be mentioned.  Try attributes
   such as alignment, alignment_branch, nodes, lengths.  For example,
   enable sampling of gap parameters, include "enable=g_parameters"
   
-  fixed=[comma separated list of parameters]

   This specifies that proposals aren't supposed to perturb the
   specified parameters.  Parameter names are of the form pS0,
   pS1,... etc (substitution parameters) or pI0, pI1, ... etc (indel
   parameters).

-  "Use Stop"

   When considering amino acid alphabets, include a "stop" letter.
   This also affects codon models, by not removing stop codons from
   the alphabet.

-  align-constraint=[filename]

EXAMPLES:

% bali-phy align=Data/EF-Tu/5d.fasta randomize_alignment >out 2>err

% bali-phy align=Data/EF-Tu/5d.fasta smodel=gamma+INV >out 2>err

% bali-phy align=Data/5S-rRNA/5d.fasta disable=g_parameters gaps=star >out 2>err







THE OUTPUT

When run in a clean directory, bali-phy produces the following output files:
 - Pr    (prior, likelihood, probability)
 - pI    (indel model parameters)
 - pS    (substitution model parameters)
 - trees (tree samples)
 - MAP   (successive estimates of the MAP point)

In addition the standard output and standard error are assumed to be names cout
and cerr.  If not, rename them in order for the following procedure to work.

ANALYZING THE OUTPUT: Procedure

Copy (or link, using ln -s) the file bali-phy-<VERSION>/bin/GNUmakefile into the current directory.  Then run the command 

% SKIP=<burnin iteerations> make

          OR
% SKIP=<burnin iteerations> SIZE=<number of iterations> make

This procedure depends on having builts the tools in the 'tools' directory, and
having the resulting tools in your path.

ANALYZING THE OUTPUT: Results

This should produce the following files:

 - Report    (A summary of results)
 - analysis  (A summary of the data analyzed)
 - tc        (Detailed description of posterior support for trees
              and partitions)
 - MAP.fasta (An estimate of the MAP alignment, w/ taxa sorted by similarity)
 - MAP.phy   (An estimate of the MAP alignment, w/ taxa sorted by similarity)
 - MAP.tree  (An estimate of the MAP tree, in Newick format)
 - tree.srq  (A bit vector of the time-series of the support of the MAP.tree)
 - tree.plot (A summed version of tree.srq.  Type "plot 'tree.plot'" in gnuplot)

In addition, if you type 'SKIP=<burnin> make blame.html', the following files
will be produced:

 - blame.html (An AU plot)
 - blame.prob (the probabilities for each letter in the AU plot)


To pin columns of the alignment, specify alignment constraints in a
file as follows:
  1. Use the argument "align-constraint=[filename]"
  2. The filename refers to a file in which each line represents a constraint.

Each line consists of a list of sequence positions, with the first
position corresponding to the first leaf sequence, the second position
corresponding to the second leaf sequence, etc.  Thus, if there are
<n> leaf taxa, then each line corresponds to a space-separated list of
<n> integers.

For example,

1 2 2

means that position 1 of leaf sequence 1 is aligned to position 2 of
leaf sequences 2 and 3. 

Note that the first position in a sequence is position 0.

Optionally, one may use a '-' instead of an integer, which denotes a
lack of constraint for that sequence.  This can be useful as follows:

1 1 - -
- - 1 1

the above constraint forces alignment between sequences 1&2 and
between sequences 3&4.
