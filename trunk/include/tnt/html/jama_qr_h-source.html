<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta name="robots" content="noindex">
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>jama_qr.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.2.5 on Wed Aug 28 02:59:45 2002 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; </center>
<hr><h1>jama_qr.h</h1><a href="jama_qr_h.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="preprocessor">#ifndef JAMA_QR_H</font>
00002 <font class="preprocessor"></font><font class="preprocessor">#define JAMA_QR_H</font>
00003 <font class="preprocessor"></font>
00004 <font class="preprocessor">#include "tnt_array1d.h"</font>
00005 <font class="preprocessor">#include "tnt_array2d.h"</font>
00006 <font class="preprocessor">#include "tnt_math_utils.h"</font>
00007 
00008 <font class="keyword">namespace </font>JAMA
00009 {
00010 
00033 
00034 template &lt;class Real&gt;
<a name="l00035"></a><a class="code" href="class_JAMA__QR.html">00035</a> <font class="keyword">class </font>QR {
00036 
00037 
00041    
00042    TNT::Array2D&lt;Real&gt; QR_;
00043 
00048    <font class="keywordtype">int</font> m, n;
00049 
00053    TNT::Array1D&lt;Real&gt; Rdiag;
00054 
00055 
00056 <font class="keyword">public</font>:
00057         
<a name="l00063"></a><a class="code" href="class_JAMA__QR.html#a0">00063</a>         <a class="code" href="class_JAMA__QR.html#a0">QR</a>(<font class="keyword">const</font> TNT::Array2D&lt;Real&gt; &amp;A)         <font class="comment">/* constructor */</font>
00064         {
00065       QR_ = A.copy();
00066       m = A.dim1();
00067       n = A.dim2();
00068       Rdiag = TNT::Array1D&lt;Real&gt;(n);
00069 
00070       <font class="comment">// Main loop.</font>
00071       <font class="keywordflow">for</font> (<font class="keywordtype">int</font> k = 0; k &lt; n; k++) {
00072          <font class="comment">// Compute 2-norm of k-th column without under/overflow.</font>
00073          Real nrm = 0;
00074          <font class="keywordflow">for</font> (<font class="keywordtype">int</font> i = k; i &lt; m; i++) {
00075             nrm = hypot(nrm,QR_[i][k]);
00076          }
00077 
00078          <font class="keywordflow">if</font> (nrm != 0.0) {
00079             <font class="comment">// Form k-th Householder vector.</font>
00080             <font class="keywordflow">if</font> (QR_[k][k] &lt; 0) {
00081                nrm = -nrm;
00082             }
00083             <font class="keywordflow">for</font> (<font class="keywordtype">int</font> i = k; i &lt; m; i++) {
00084                QR_[i][k] /= nrm;
00085             }
00086             QR_[k][k] += 1.0;
00087 
00088             <font class="comment">// Apply transformation to remaining columns.</font>
00089             <font class="keywordflow">for</font> (<font class="keywordtype">int</font> j = k+1; j &lt; n; j++) {
00090                Real s = 0.0; 
00091                <font class="keywordflow">for</font> (<font class="keywordtype">int</font> i = k; i &lt; m; i++) {
00092                   s += QR_[i][k]*QR_[i][j];
00093                }
00094                s = -s/QR_[k][k];
00095                <font class="keywordflow">for</font> (<font class="keywordtype">int</font> i = k; i &lt; m; i++) {
00096                   QR_[i][j] += s*QR_[i][k];
00097                }
00098             }
00099          }
00100          Rdiag[k] = -nrm;
00101       }
00102    }
00103 
00104 
<a name="l00110"></a><a class="code" href="class_JAMA__QR.html#a1">00110</a>         <font class="keywordtype">int</font> <a class="code" href="class_JAMA__QR.html#a1">isFullRank</a>()<font class="keyword"> const          </font>
00111 <font class="keyword">        </font>{
00112       <font class="keywordflow">for</font> (<font class="keywordtype">int</font> j = 0; j &lt; n; j++) 
00113           {
00114          <font class="keywordflow">if</font> (Rdiag[j] == 0)
00115             <font class="keywordflow">return</font> 0;
00116       }
00117       <font class="keywordflow">return</font> 1;
00118         }
00119         
00120         
00121 
00122 
00128 
<a name="l00129"></a><a class="code" href="class_JAMA__QR.html#a2">00129</a>    TNT::Array2D&lt;Real&gt; <a class="code" href="class_JAMA__QR.html#a2">getHouseholder</a> (<font class="keywordtype">void</font>)  <font class="keyword">const</font>
00130    {
00131           TNT::Array2D&lt;Real&gt; H(m,n);
00132 
00133           <font class="comment">/* note: H is completely filled in by algorithm, so</font>
00134 <font class="comment">             initializaiton of H is not necessary.</font>
00135 <font class="comment">          */</font>
00136       <font class="keywordflow">for</font> (<font class="keywordtype">int</font> i = 0; i &lt; m; i++) 
00137           {
00138          <font class="keywordflow">for</font> (<font class="keywordtype">int</font> j = 0; j &lt; n; j++) 
00139                  {
00140             <font class="keywordflow">if</font> (i &gt;= j) {
00141                H[i][j] = QR_[i][j];
00142             } <font class="keywordflow">else</font> {
00143                H[i][j] = 0.0;
00144             }
00145          }
00146       }
00147           <font class="keywordflow">return</font> H;
00148    }
00149 
00150 
00151 
00155 
<a name="l00156"></a><a class="code" href="class_JAMA__QR.html#a3">00156</a>         TNT::Array2D&lt;Real&gt; <a class="code" href="class_JAMA__QR.html#a3">getR</a>()<font class="keyword"> const</font>
00157 <font class="keyword">        </font>{
00158       TNT::Array2D&lt;Real&gt; R(n,n);
00159       <font class="keywordflow">for</font> (<font class="keywordtype">int</font> i = 0; i &lt; n; i++) {
00160          <font class="keywordflow">for</font> (<font class="keywordtype">int</font> j = 0; j &lt; n; j++) {
00161             <font class="keywordflow">if</font> (i &lt; j) {
00162                R[i][j] = QR_[i][j];
00163             } <font class="keywordflow">else</font> <font class="keywordflow">if</font> (i == j) {
00164                R[i][j] = Rdiag[i];
00165             } <font class="keywordflow">else</font> {
00166                R[i][j] = 0.0;
00167             }
00168          }
00169       }
00170           <font class="keywordflow">return</font> R;
00171    }
00172         
00173         
00174 
00175 
00176 
00181 
<a name="l00182"></a><a class="code" href="class_JAMA__QR.html#a4">00182</a>         TNT::Array2D&lt;Real&gt; <a class="code" href="class_JAMA__QR.html#a4">getQ</a>()<font class="keyword"> const</font>
00183 <font class="keyword">        </font>{
00184           TNT::Array2D&lt;Real&gt; Q(m,n);
00185       <font class="keywordflow">for</font> (<font class="keywordtype">int</font> k = n-1; k &gt;= 0; k--) {
00186          <font class="keywordflow">for</font> (<font class="keywordtype">int</font> i = 0; i &lt; m; i++) {
00187             Q[i][k] = 0.0;
00188          }
00189          Q[k][k] = 1.0;
00190          <font class="keywordflow">for</font> (<font class="keywordtype">int</font> j = k; j &lt; n; j++) {
00191             <font class="keywordflow">if</font> (QR_[k][k] != 0) {
00192                Real s = 0.0;
00193                <font class="keywordflow">for</font> (<font class="keywordtype">int</font> i = k; i &lt; m; i++) {
00194                   s += QR_[i][k]*Q[i][j];
00195                }
00196                s = -s/QR_[k][k];
00197                <font class="keywordflow">for</font> (<font class="keywordtype">int</font> i = k; i &lt; m; i++) {
00198                   Q[i][j] += s*QR_[i][k];
00199                }
00200             }
00201          }
00202       }
00203           <font class="keywordflow">return</font> Q;
00204    }
00205 
00212 
<a name="l00213"></a><a class="code" href="class_JAMA__QR.html#a5">00213</a>    TNT::Array2D&lt;Real&gt; <a class="code" href="class_JAMA__QR.html#a5">solve</a>(<font class="keyword">const</font> TNT::Array2D&lt;Real&gt; &amp;B)<font class="keyword"> const</font>
00214 <font class="keyword">   </font>{
00215           <font class="keywordflow">if</font> (B.dim1() != m)            <font class="comment">/* arrays must be conformant */</font>
00216                 <font class="keywordflow">return</font> TNT::Array2D&lt;Real&gt;(0,0);
00217 
00218           <font class="keywordflow">if</font> ( !<a class="code" href="class_JAMA__QR.html#a1">isFullRank</a>() )          <font class="comment">/* matrix is rank deficient */</font>
00219           {
00220                 <font class="keywordflow">return</font> TNT::Array2D&lt;Real&gt;(0,0);
00221           }
00222 
00223       <font class="keywordtype">int</font> nx = B.dim2(); 
00224           TNT::Array2D&lt;Real&gt; X = B;
00225 
00226 
00227       <font class="comment">// Compute Y = transpose(Q)*B</font>
00228       <font class="keywordflow">for</font> (<font class="keywordtype">int</font> k = 0; k &lt; n; k++) {
00229          <font class="keywordflow">for</font> (<font class="keywordtype">int</font> j = 0; j &lt; nx; j++) {
00230             Real s = 0.0; 
00231             <font class="keywordflow">for</font> (<font class="keywordtype">int</font> i = k; i &lt; m; i++) {
00232                s += QR_[i][k]*X[i][j];
00233             }
00234             s = -s/QR_[k][k];
00235             <font class="keywordflow">for</font> (<font class="keywordtype">int</font> i = k; i &lt; m; i++) {
00236                X[i][j] += s*QR_[i][k];
00237             }
00238          }
00239       }
00240       <font class="comment">// Solve R*X = Y;</font>
00241       <font class="keywordflow">for</font> (<font class="keywordtype">int</font> k = n-1; k &gt;= 0; k--) {
00242          <font class="keywordflow">for</font> (<font class="keywordtype">int</font> j = 0; j &lt; nx; j++) {
00243             X[k][j] /= Rdiag[k];
00244          }
00245          <font class="keywordflow">for</font> (<font class="keywordtype">int</font> i = 0; i &lt; k; i++) {
00246             <font class="keywordflow">for</font> (<font class="keywordtype">int</font> j = 0; j &lt; nx; j++) {
00247                X[i][j] -= X[k][j]*QR_[i][k];
00248             }
00249          }
00250       }
00251 
00252 
00253           <font class="comment">/* return n x nx portion of X */</font>
00254           TNT::Array2D&lt;Real&gt; X_(n,nx);
00255           <font class="keywordflow">for</font> (<font class="keywordtype">int</font> i=0; i&lt;n; i++)
00256                 <font class="keywordflow">for</font> (<font class="keywordtype">int</font> j=0; j&lt;nx; j++)
00257                         X_[i][j] = X[i][j];
00258 
00259           <font class="keywordflow">return</font> X_;
00260    }
00261 
00262 };
00263 
00264 
00265 }
00266 <font class="comment">// namespace JAMA</font>
00267 
00268 <font class="preprocessor">#endif</font>
00269 <font class="preprocessor"></font><font class="comment">// JAMA_QR__H</font>
00270 
</div></pre><hr><address><small>Generated at Wed Aug 28 02:59:45 2002 for TemplateNumericalToolkit(TNT) by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.5 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2001</small></address>
</body>
</html>
